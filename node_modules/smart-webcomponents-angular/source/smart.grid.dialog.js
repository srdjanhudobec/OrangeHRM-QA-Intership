
/* Smart UI v15.3.13 (2023-07-15) 
Copyright (c) 2011-2023 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart.Utilities.Assign("Grid.Dialog",class{_createOverlay(){const e=document.createElement("div");return e.onpointerdown=function(){return!1},e.onmousedown=function(){return!1},e.onclick=function(){},e.classList.add("smart-grid-dialog-overlay"),e}_dragDialog(e,t){const a=this,l=a._dialogDragDetails.dialog;if(!e||l.pinned||l.maximized)return;if(!a._dialogDragDetails.started)return;let i,n;i=e.pageX-a._dialogDragDetails.x,n=e.pageY-a._dialogDragDetails.y;const o=Math.max(a._windowParent.element.clientHeight,a._windowParent.scrollElement.scrollHeight),r=Math.max(a._windowParent.element.clientWidth,a._windowParent.scrollElement.scrollWidth);switch(t){case"horizontal":a._dialogDragDetails.windowX=Math.max(0,Math.min(a._dialogDragDetails.windowX+i,r-l.offsetWidth)),l.style.left=a._dialogDragDetails.windowX+"px";break;case"vertical":a._dialogDragDetails.windowY=Math.max(0,Math.min(a._dialogDragDetails.windowY+n,o-l.offsetHeight)),l.style.top=a._dialogDragDetails.windowY+"px";break;case"both":a._dialogDragDetails.windowX=Math.max(0,Math.min(a._dialogDragDetails.windowX+i,r-l.offsetWidth)),a._dialogDragDetails.windowY=Math.max(0,Math.min(a._dialogDragDetails.windowY+n,o-l.offsetHeight)),l.style.left=a._dialogDragDetails.windowX+"px",l.style.top=a._dialogDragDetails.windowY+"px"}a._dialogDragDetails.top=l.offsetTop,a._dialogDragDetails.left=l.offsetLeft,a._dialogDragDetails.x=Math.max(a._windowParent.offsetLeft+a._dialogDragDetails.offsetX-a._windowParent.scrollElement.scrollLeft,Math.min(a._windowParent.offsetLeft+a._windowParent.element.offsetWidth-(a._windowParent.element.offsetWidth-l.offsetLeft)+a._dialogDragDetails.offsetX,e.pageX)),a._dialogDragDetails.y=Math.max(a._windowParent.offsetTop+a._dialogDragDetails.offsetY-a._windowParent.scrollElement.scrollTop,Math.min(a._windowParent.offsetTop+a._windowParent.element.offsetHeight-(a._windowParent.element.offsetHeight-l.offsetTop)+a._dialogDragDetails.offsetY,e.pageY))}_updateDialogDragDetails(e,t,a){const l=this;if(l._windowParent={initialParent:t.parentElement,element:document.documentElement,scrollElement:document.scrollingElement},l._dialogDragDetails||(l._dialogDragDetails={}),void 0===l._dialogDragDetails.minWidth||void 0===l._dialogDragDetails.minHeight||void 0===l._dialogDragDetails.maxWidth||void 0===l._dialogDragDetails.maxHeight){const e=getComputedStyle(t);l._dialogDragDetails.minWidth=parseFloat(e.getPropertyValue("min-width"))||0,l._dialogDragDetails.minHeight=parseFloat(e.getPropertyValue("min-height"))||0,l._dialogDragDetails.maxWidth=parseFloat(e.getPropertyValue("max-width"))||0,l._dialogDragDetails.maxHeight=parseFloat(e.getPropertyValue("max-height"))||0}l._dialogDragDetails.dialog=t,l._dialogDragDetails.windowX=t.offsetLeft,l._dialogDragDetails.windowY=t.offsetTop;const i=t.getBoundingClientRect(),n=t.parentElement===document.body?document.documentElement.getBoundingClientRect():t.parentElement?t.parentElement.getBoundingClientRect():document.documentElement.getBoundingClientRect(),o=window.scrollX||window.pageXOffset,r=window.scrollY||window.pageYOffset;l._windowParent.offsetLeft=n.left+o,l._windowParent.offsetTop=n.top+r,a&&"object"==typeof a&&(l._dialogDragDetails.offsetX=a.clientX-i.left,l._dialogDragDetails.offsetY=a.clientY-i.top),t.collapsed||(l.hasAnimation&&"minimize"===e?(l._dialogDragDetails.width=l._dialogDragDetails.width?l._dialogDragDetails.width:t.offsetWidth,l._dialogDragDetails.height=l._dialogDragDetails.height?l._dialogDragDetails.height:t.offsetHeight):(l._dialogDragDetails.width=t.offsetWidth,l._dialogDragDetails.height=t.offsetHeight),(t.style.width||t.style.height)&&(l._dialogDragDetails.resized=!0)),"minimize"!==e&&e&&(l._dialogDragDetails.type=e,l._dialogDragDetails.started=!0,l._dialogDragDetails.snapWindowWidth=t.offsetWidth,l._dialogDragDetails.snapWindowHeight=t.offsetHeight,a&&"object"==typeof a?(l._dialogDragDetails.x=a.pageX,l._dialogDragDetails.y=a.pageY):(l._dialogDragDetails.x=t.offsetLeft,l._dialogDragDetails.y=t.offsetTop))}_createDialog(e){const t=this;let a=document.createElement("div");e||(e=t.editing.dialog),void 0!==e.modal&&(a.modal=e.modal),void 0!==e.screenModal&&(a.screenModal=e.screenModal),a.setAttribute("animation","none"),a.classList.add("smart-window","smart-grid-dialog"),a.style.width="auto"===e.width?e.width:e.width+"px",a.style.height="auto"===e.height?e.height:e.height+"px",e.width&&"string"==typeof e.width&&(a.style.width=e.width),e.height&&"string"==typeof e.height&&(a.style.height=e.height),a.style.left="",a.style.top="",a.innerHTML=`<div class="smart-container">\n                   <div class ="smart-content-container" smart-id="container">\n                        <div id="headerSection" class="smart-header-section">\n                            <div class="smart-header"></div>\n                            <div class="smart-buttons-container">\n                            <button title="${t.localize("pagerPreviousButton")}" tabindex=-1 class ="smart-hidden smart-button smart-element smart-prev-button" aria-label="Previous Record" smart-id="prevButton"></button>\n                            <button title="${t.localize("pagerNextButton")}" tabindex=-1 class ="smart-hidden smart-button smart-element smart-next-button" aria-label="Next Record" smart-id="nextButton"></button>\n                            <button title="${t.localize("contextMenuItemDelete")}" tabindex=-1 class="smart-visibility-hidden smart-hidden smart-delete-button smart-grid-icon smart-icon-delete show smart-button smart-element" aria-label="Delete Row" smart-id="deleteButton"></button>\n                            <button title="${t.localize("copyURL")}" tabindex=-1 class="smart-visibility-hidden smart-hidden smart-copy-row-button smart-grid-icon smart-icon-link show smart-button smart-element" aria-label="Copy URL" smart-id="urlButton"></button>\n                            <button title="${t.localize("comments")}" tabindex=-1 class ="smart-visibility-hidden smart-hidden smart-comments-button smart-grid-icon smart-icon-comment show smart-button smart-element" aria-label="Comments" smart-id="commentsButton"></button>\n                            <button title="${t.localize("close")}" class ="smart-button smart-element smart-close-button" aria-label="Close" smart-id="closeButton"></button>\n                            </div>\n                        </div>\n                        <div class="smart-content"><div class="smart-content-container"></div></div>\n                        <div class ="smart-footer">\n                       \n                        <div class ="smart-stack-layout right spacing">\n                                <smart-button class ="smart-confirm-button item primary">Ok</smart-button>\n                                <smart-button class ="smart-cancel-button item">Cancel</smart-button>\n                          </div>\n                        </div>\n                    </div>\n              </div>\n            `,a.querySelector&&a.querySelector(".smart-content")&&(a.content=a.querySelector(".smart-content").firstChild),a.footer=a.querySelector(".smart-footer"),a.header=a.querySelector(".smart-header"),a.btnConfirm=a.querySelector(".smart-confirm-button"),a.btnCancel=a.querySelector(".smart-cancel-button"),a.btnDelete=a.querySelector(".smart-delete-button"),a.btnClose=a.querySelector(".smart-close-button"),a.btnNext=a.querySelector(".smart-next-button"),a.btnPrev=a.querySelector(".smart-prev-button"),a.btnComments=a.querySelector(".smart-comments-button"),a.btnLink=a.querySelector(".smart-copy-row-button"),a.headerSection=a.querySelector(".smart-header-section"),a.btnLink.onclick=()=>{let e=document.createElement("input"),t=window.location.href+"#activeRows="+a.row.id;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then((()=>{})):(document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e))},a.btnDelete.onclick=()=>{a.row.id;const e=t.editing.deleteDialog.enabled;t.editing.deleteDialog.enabled=!0,t.cancelEdit(),a.close(),t._openDeleteRowDialog(a.row.id,(function(e){t.deleteRow(e)})),t.editing.deleteDialog.enabled=e,a.close()},a.btnComments.onclick=()=>{const e=a.querySelector(".smart-grid-edit-dialog-layout");e&&e.classList.toggle("hide-activity")},!1!==a.allowDrag&&(a.headerSection.onpointerdown=e=>{t._updateDialogDragDetails("drag",a,e)},a.headerSection.onpointerup=()=>{t._dialogDragDetails&&(t._dialogDragDetails.started=!1)});const l=document.createElement("div");return l.classList.add("smart-grid-dialog-overlay"),l.onclick=function(){},a.overlay=l,a.remove=function(){a.parentNode&&a.parentNode.removeChild(a)},a.close=function(){a.classList.remove("open"),delete t._resizeHandling,a.addEventListener("transitionend",a.remove),a.addEventListener("transitioncancel",a.remove),a.modal&&a.overlay.parentNode&&a.overlay.parentNode.removeChild(a.overlay),a.onClose&&a.onClose()},a.open=function(l,i){a.removeEventListener("transitionend",a.remove),a.removeEventListener("transitioncancel",a.remove),t.isInShadowDOM?t.getRootNode().appendChild(a):document.body.appendChild(a),t._resizeHandling=!1,void 0===l&&(l=e.left),void 0===i&&(i=e.top),requestAnimationFrame((function(){a.classList.add("open");const e=a.querySelector('[bind="name"]');if(e){const t=e.querySelector("smart-input");t&&t.focus()}const n=function(e,l){const i=t.offset(t);switch("center"===e&&"horizontal"===l&&(e="middle"),e){case"top":return i.top;case"bottom":return Math.max(i.top,i.top+t.offsetHeight-a.offsetHeight);case"center":return Math.max(i.top,i.top+t.offsetHeight/2-a.offsetHeight/2);case"left":return i.left;case"middle":return i.left+t.offsetWidth/2-a.offsetWidth/2;case"right":return i.left+t.offsetWidth-a.offsetWidth}return"horizontal"===l?parseInt(e)+i.left:"vertical"===l?parseInt(e)+i.top:"number"==typeof e?e:parseInt(e)};a.style.left=n(l,"horizontal")+"px",a.style.top=n(i,"vertical")+"px",a.setPosition=(e,t)=>{t?a.style.left=n(e,"horizontal")+"px":a.style.top=n(e,"vertical")+"px"},"screenMiddle"===l&&(a.style.left="calc(50% - "+a.offsetWidth/2+"px)"),"screenCenter"===i&&(a.style.top="calc(50% - "+a.offsetHeight/2+"px)")})),a.modal&&(a.screenModal?t.isInShadowDOM?t.getRootNode().appendChild(a.overlay):document.body.appendChild(a.overlay):t.appendChild(a.overlay)),a.onOpen&&a.onOpen()},a}_openAddRowDialog(e,t){const a=this;if(!a.editing.addDialog.enabled)return!1;const l=a._dialogAddRow||a._createDialog(),i="{{message}}"===a.editing.dialog.header?a.localize("dialogAddHeader"):a.editing.dialog.header,n=l.content;l.header.innerHTML=i,e.grid=a,void 0===e.index&&(e.index=a.rows.length,a._rowsAdded&&(e.index+=a._rowsAdded.length));const o=e.cells;let r=null,s=0;if(a._cellEditors||(a._cellEditors=[]),!a._dialogAddRow){l.modal=!0,l.btnConfirm.innerHTML=a.localize("dialogAddButtonConfirm"),l.btnCancel.innerHTML=a.localize("dialogAddButtonCancel"),l.onOpen=function(){a.editing.dialog.visible=!0},l.onClose=function(){a.editing.dialog.visible=!1},l.btnCancel.onclick=function(){l.close()},l.btnClose.onclick=function(){l.close()},l.btnConfirm.onclick=function(){const e={};for(let t=0;t<o.length;t++){const l=o[t],i=a._getEditorValue(l),n=a._getEditorId(l),r=a._cellEditors[n];r&&(i&&i.error?(e[l.column.dataField]=i.value,r.detach()):(e[l.column.dataField]=i,r.detach()))}const i=a._rowsAdded?a._rowsAdded.length:0,n=new Smart.Grid.Row({index:a.rows.length+i,id:Smart.Utilities.Core.createGUID(),grid:a,data:e});l.close(),t(n,0===l.index)},l.onkeydown=function(e){const t=e.key;"Enter"===t?l.btnConfirm.onclick():"Escape"===t&&l.close()},n.classList.add("smart-grid-layout");for(let e=0;e<a.columns.length;e++){const t=a.columns[e];if(!t.allowEdit)continue;s%2==0&&(r=document.createElement("div"),r.classList.add("smart-grid-edit-dialog-row"),n.appendChild(r));const l=document.createElement("div");l.classList.add("col-sm-6");const i=document.createElement("div");i.classList.add("column");const o=document.createElement("label");o.innerHTML=a.columns[e].label;const d=document.createElement("div");d.classList.add("smart-grid-dialog-editor"),d.setAttribute("editor",t.dataField),d.setAttribute("template",t.editor.template),l.appendChild(i),r.appendChild(l),i.appendChild(o),i.appendChild(d),s++}}l.open(),l.index=e.index;let d=0;for(let e=0;e<o.length;e++){const t=o[e],i=t.column,n=i.dataField,r=l.querySelector("[editor="+n+"]");if(!r)continue;r.innerHTML="";let s="";void 0!==t.value&&(s=t.value),"int64"!==i.dataType&&"number"!==i.dataType&&"int"!==i.dataType&&"float"!==i.dataType||(s=0),"date"===i.dataType&&(s=new Date),"bool"!==i.dataType&&"boolean"!==i.dataType||(s=!1);let c=null;switch(t.editor.template){default:case"custom":c=a._getCustomCellEditor(t);break;case"image":c=a._getImageCellEditor(t);break;case"checkBox":c=a._getCheckBoxCellEditor(t);break;case"autoComplete":c=a._getAutoCompleteCellEditor(t);break;case"dropDownList":c=a._getAutoCompleteCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"comboBox":c=a._getAutoCompleteCellEditor(t),c.readonly=!1,c.dropDownButtonPosition="right";break;case"maskedTextBox":c=a._getMaskCellEditor(t);break;case"checkInput":c=a._getCheckInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiInput":c=a._getMultiInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiComboInput":c=a._getMultiComboInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"time":case"timeInput":c=a._getTimeInputCellEditor(t);break;case"date":case"dateInput":c=a._getDateInputCellEditor(t);break;case"dateRangeInput":c=a._getDateRangeInputCellEditor(t);break;case"dateTimePicker":c=a._getDateTimePickerCellEditor(t);break;case"textArea":case"textarea":c=a._getTextAreaCellEditor(t);break;case"numberInput":case"text":case"input":c="numberInput"===t.editor.template?a._getNumberInputCellEditor(t):a._getInputCellEditor(t)}if(c.attach(),t.editor.instance=c,c.setValue(s),0===d&&setTimeout((()=>{c.focus()}),100),!t.editor.isInitialized&&(t.editor.isInitialized=!0,t.editor.onInit)){const e=t.editor.onInit(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const a="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)a[t]=e[t]}));else if(e){const a=e,l="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in a)l[e]=a[e]}}if(t.editor.onRender){const e=t.editor.onRender(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const a="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)a[t]=e[t]}));else if(e){const a=e,l="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in a)l[e]=a[e]}}r.appendChild(c.element),c.element.onfocus=()=>{r.setAttribute("focus","")},c.element.onblur=()=>{r.removeAttribute("focus")},d++}a._dialogAddRow=l}_openEditDialog(e,t){const a=this;if(!a.editing.dialog.enabled)return!1;const l=a._dialogEdit||a._createDialog();let i="{{message}}"===a.editing.dialog.header?a.localize("dialogEditHeader",{value:a.editing.editRow?e.row.visibleIndex+1:e.column.label}):a.editing.dialog.header;const n=l.content;!1===a.editing.enabled?(l.classList.add("disable-edit"),i="{{message}}"===a.editing.dialog.header?a.localize("dialogEditHeaderDisabled",{value:a.editing.editRow?e.row.visibleIndex+1:e.column.label}):a.editing.dialog.header):l.classList.remove("disable-edit"),l.header.innerHTML=i,l.row=a.editing.editRow,a.editing.recordNavigation&&l.classList.add("disable-animation");let o,r,s=null,d=0;if(void 0!==a._settingsDialogRowId){l.btnPrev.classList.remove("smart-hidden"),l.btnNext.classList.remove("smart-hidden"),a.editing.enabled?(l.btnDelete.classList.remove("smart-hidden"),l.btnComments.classList.remove("smart-hidden"),l.btnLink.classList.remove("smart-hidden"),l.btnDelete.classList.remove("smart-visibility-hidden"),l.btnComments.classList.remove("smart-visibility-hidden"),l.btnLink.classList.remove("smart-visibility-hidden")):l.btnLink.style.width=l.btnDelete.style.width=l.btnComments.style.width="0px";const e=e=>{const t=a.editing.editRow,i=a._recyclingRows.indexOf(t);let n=e?a._recyclingRows[i+1]:a._recyclingRows[i-1];if(a.grouping.enabled&&a.dataSource.groupBy&&a.dataSource.groupBy.length>0){let t=1;for(;n&&!n.leaf;)n=e?a._recyclingRows[i+t]:a._recyclingRows[i-t],t++}if(n){l.classList.add("disable-animation"),a.editing.recordNavigation=!0;const e=l.querySelector("[focus]");if(e){const t=e.closest(".smart-grid-edit-dialog-row"),l=t.closest(".smart-grid-edit-dialog-editors-container");let i=-1;if(l&&(i=[...l.children].indexOf(t)),a.cancelEdit(),a._openRowSettingsDialog(n.id),a._dialogEdit&&i>=0){const e=a._dialogEdit.querySelectorAll(".smart-grid-edit-dialog-row")[i];if(e&&a.editing.enabled){const t=e.querySelector(".smart-grid-dialog-editor");t.setAttribute("focus",""),t.querySelector(".smart-grid-cell-editor").focus()}}}else a._dialogEditPosition={left:a._dialogEdit.style.left,top:a._dialogEdit.style.top},a.cancelEdit(),a._openRowSettingsDialog(n.id),delete a._dialogEditPosition}};l.btnNext.onmousedown=t=>{e(!0),t.preventDefault(),t.stopPropagation()},l.btnPrev.onmousedown=t=>{e(!1),t.preventDefault(),t.stopPropagation()}}if(!a._dialogEdit)if(l.modal=!0,l.btnConfirm.innerHTML=a.localize("dialogEditButtonConfirm"),l.btnCancel.innerHTML=a.localize("dialogEditButtonCancel"),l.onOpen=function(){a.editing.dialog.visible=!0,a._settingsDialogRowId&&l.editorsContent&&l.editorsContent.offsetHeight&&(l.editorsContent.style.maxHeight=l.editorsContent.offsetHeight+40+"px")},l.onClose=function(){a.editing.dialog.visible=!1,l.row&&(l.row.showDetail=!1)},l.btnCancel.onclick=function(){a.editing.isEditing=!0,a.cancelEdit()},l.btnClose.onclick=function(){a.editing.isEditing=!0,a.cancelEdit()},l.btnConfirm.onclick=function(){if(void 0!==a._settingsDialogRowId){if(a.rowById[a._settingsDialogRowId]){const e=a.editing.editRow;if(!e)return!1;const t=e.cells;let i={};e.element.removeAttribute("error");for(let e=0;e<t.length;e++){const l=t[e],n=a._getEditorValue(l);i[l.column.dataField]=n}const n=a.validateRow(e.id,i);if(Object.keys(n).length>0){let e=!0;for(let i=0;i<t.length;i++){const o=t[i],r=n[o.column.dataField],s=l.querySelector(`[label-for="${o.column.dataField}"]`);if(s&&(s.innerHTML=""),r)for(let t in r){const l=r[t];let i="";if(!l)continue;let n=l[t];"minLength"!==t&&"maxLength"!==t||(n=l[t.toLowerCase()]),i=l.message?l.message:"required"===t||"valueMissing"===t?a.localize("requiredValue",{value:o.column.label}):"min"===t?a.localize("invalidMinValue",{value:o.column.label,min:n.min}):"max"===t?a.localize("invalidMaxValue",{value:o.column.label,max:n.max}):"minLength"===t?a.localize("invalidMinLengthValue",{value:o.column.label,min:n.requiredLength}):"maxLength"===t?a.localize("invalidMaxLengthValue",{value:o.column.label,max:n.requiredLength}):a.localize("invalidValue"),e=!1,s&&(s.innerHTML=i)}}if(!e)return}const o=e.style;e.updatedDate=new Date,e.updatedBy=a.currentUser,e.style=l._rowStyle,e.comments=l._rowComments;const r=a.dataSource.dataItemById[e.id];if(r){const t=r.$.index;a.dataSource&&e.comments!==a.dataSource.boundSource[t].comments&&(a._sortedColumns&&a._sortedColumns.length>0?r.comments=e.comments:a.dataSource.boundSource[t].comments=e.comments)}e.style=l._rowStyle,a.onRowStyle&&o!==e.style&&(null===o?a.onRowStyle(e.index,e,e.style):o.background===e.style.background&&o.color===e.style.color&&o.fontSize===e.style.fontSize&&o.fontStyle===e.style.fontStyle&&o.fontFamily===e.style.fontFamily&&o.fontWeight===e.style.fontWeight&&o.status===e.style.status&&o.textDecoration===e.style.textDecoration||a.onRowStyle(e.index,e,e.style))}if(l.columnVisibility){let e=!1;const t=a.columns.canNotify;a.columns.canNotify=!1;for(let t in l.columnVisibility){const i=a.columnByDataField[t];i.visible!==l.columnVisibility[t]&&(i.visible=l.columnVisibility[t],e=!0)}if(a.columns.canNotify=t,e)return a.endEdit(),a.refresh(!1),void(a.dataSource&&a.dataSource.boundHierarchy&&(a.dataSource.refreshHierarchy(),a._refreshRowHierarchy(),a.refresh()))}}a.endEdit(),a.dataSource&&a.dataSource.boundHierarchy&&(a.dataSource.refreshHierarchy(),a._refreshRowHierarchy(),a.refresh())},l.onkeydown=function(e){const t=e.key,l=a.editing.commandKeys;for(let e in l){const i=l[e];if(t===i.key){a._applyCommand(i.command);break}}},a.editing.editRow)if(void 0!==a._settingsDialogRowId)a._applySettingsDialogLayout(l,n,a.editing.editRow);else{n.classList.add("smart-grid-layout");for(let e=0;e<a.columns.length;e++){const t=a.columns[e];if(!t.allowEdit)continue;d%2==0&&(s=document.createElement("div"),s.classList.add("smart-grid-edit-dialog-row"),n.appendChild(s));const l=document.createElement("div");l.classList.add("col-sm-6");const i=document.createElement("div");i.classList.add("column");const o=a._settingsDialogRowId?document.createElement("div"):document.createElement("label");o.innerHTML=a.columns[e].label;const r=document.createElement("div");r.classList.add("smart-grid-dialog-editor"),r.setAttribute("editor",t.dataField),r.setAttribute("template",t.editor.template),l.appendChild(i),s.appendChild(l),i.appendChild(o),i.appendChild(r),d++}}else{const t=e.column,a=document.createElement("div");a.classList.add("smart-grid-dialog-editor"),a.setAttribute("editor",""),a.setAttribute("template",t.editor.template),n.appendChild(a)}if(a._dialogEditPosition){const e=a.offset(a);o=parseInt(a._dialogEditPosition.left)-e.left,r=parseInt(a._dialogEditPosition.top)-e.top}if(l.open(o,r),a.editing.editRow){const a=l.querySelector("[editor="+e.column.dataField+"]");a&&(a.innerHTML="",a.appendChild(t.element),a.editor=t,a.editorValue=t.getValue(),t.element.onfocus=()=>{a.setAttribute("focus",""),a.setAttribute("touched",""),a.editorValue=t.getValue()},t.element.onblur=()=>{a.removeAttribute("focus"),a.editorValue!==t.getValue()&&a.setAttribute("pending","")})}else{const a=e.column,i=l.querySelector("[editor]");i.innerHTML="",i.setAttribute("template",a.editor.template),i.appendChild(t.element),i.editor=t,i.editorValue=t.getValue(),t.element.onfocus=()=>{i.setAttribute("focus",""),i.setAttribute("touched",""),i.editorValue=t.getValue()},t.element.onblur=()=>{i.removeAttribute("focus"),i.editorValue!==t.getValue()&&i.setAttribute("pending","")}}a._dialogEdit=l}_refreshCurrentUser(){const e=this,t=e.users;let a=e.currentUser,l=!0,i=!0,n=e.editing.enabled,o=!0;t&&null!==a&&(a=t.find((e=>e.id===a)),a&&(l=!1!==a.allowAdd,i=!1!==a.allowComment,n=n&&!1!==a.allowEdit,o=!1!==a.allowRemove)),e._currentUser={allowAdd:l,allowComment:i,allowEdit:n,allowRemove:o,info:a}}_getColorInput(){const e=document.createElement("smart-color-input");return e.dataSource=["#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161","#FFFFFF","#000000",""],e.valueDisplayMode="colorBox",e.classList.add("underlined","smart-grid-color-input"),e.style.width="auto",e.readonly=!0,e.onRender=()=>{const t=e.$.scrollView;t&&t.classList.add("smart-grid-color-input")},e}_applySettingsDialogLayout(e,t,a){const l=this;e.classList.add("smart-grid-dialog-expand-row");const i=e._rowStyle=JSON.parse(JSON.stringify(a._style)),n=e._rowComments=JSON.parse(JSON.stringify(a.comments)),o=[];e.columnVisibility=o;const r=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div");d.appendChild(r),d.appendChild(s),t.appendChild(d),d.classList.add("smart-grid-edit-dialog-layout"),r.classList.add("smart-grid-edit-dialog-editors-container"),s.classList.add("smart-grid-edit-dialog-activity-container"),Smart.Utilities.Core.isMobile&&(d.setAttribute("mobile",""),e.setAttribute("mobile",""));let c=0;for(let e=0;e<l.columns.length;e++){const t=l.columns[e];t.allowEdit&&!1!==t._visible&&c++}c>=8?r.classList.add("many"):r.classList.remove("many"),e.editorsContent=r,e.activityContent=s;const u=document.createElement("div"),m=document.createElement("div");s.appendChild(u),s.appendChild(m);let p=n&&n.length?" ("+n.length+")":"";u.innerHTML=`\n            <div class="tabs">\n                <div view="details" class="active tab"><div class="tab-label">${l.localize("detailsTab")}</div></div>\n                <div view="comments" class="tab"><div class="tab-label">${l.localize("commentsTab")}${p}</div></div>\n                <div view="history" class="tab smart-hidden"><div class="tab-label">${l.localize("historyTab")}</div></div>\n            </div>\n            <div class="details-tab">\n                <div class="smart-grid-edit-dialog-row"><div class="column"><div class="header smart-grid-edit-dialog-column-info">${l.localize("format").replace(":","")}\n                <span title="${l.localize("resetFormat")}" class="reset-format smart-grid-icon smart-icon-reload show"></span>\n                </div>\n                </div>\n                <div class="format-layout">\n                        <div title="${l.localize("background")}" class="format smart-grid-edit-dialog-column-info">\n                            <span class="smart-grid-icon smart-icon-color-background show"></span><div class="background"></div>\n                        </div>\n                        <div title="${l.localize("color")}" class="format smart-grid-edit-dialog-column-info">\n                            <span style="border-bottom: 2px solid #46CA78;" color="#46CA78" class="format smart-grid-icon smart-icon-font show"></span><div class="color"></div>\n                        </div>\n                        <div class="format-layout button-group">\n                            <span title="${l.localize("bold")}" class="formatbtn bold smart-grid-icon smart-icon-bold show"></span>\n                            <span title="${l.localize("italic")}" class="formatbtn italic smart-grid-icon smart-icon-italic show"></span>\n                            <span title="${l.localize("underline")}" class="formatbtn underline smart-grid-icon smart-icon-underline show"></span>\n                        </div>\n                </div>\n                 <div class="format-layout font-group">\n                    <div title="${l.localize("fontFamily").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                    <span class="smart-grid-icon smart-icon-font show"></span><div class="font-family"></div>\n                    </div>\n                    <div title="${l.localize("fontSize").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                        <span class="smart-grid-icon smart-icon-fontsize show"></span><div class="font-size"></div>\n                    </div>\n                </div>\n                <div class="format-layout font-group">\n                    <div title="${l.localize("status").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                    <span color="#F1C58B" class="smart-grid-icon smart-icon-star show"></span><div class="status"></div>\n                    </div>\n                </div>\n               </div>\n            </div>\n            <div class="comments-tab smart-hidden">\n                <div class="column"><div class="comments-header smart-grid-edit-dialog-column-info">${l.localize("comments").replace(":","")}</div></div>\n                <div class="comments-layout">\n                    <div class="comments"><span class="no-comments">${l.localize("noComments")}</span></div>\n                    <div class="footer">\n                        <smart-text-area hint="${l.localize("comment")}" placeholder="${l.localize("comment")}" class="smart-text-area success underlined"></smart-text-area>\n                        <smart-button class="success">${l.localize("send")}</smart-button>\n                    </div>\n                </div>\n            </div>\n            <div class="history-tab smart-hidden">\n                <div class="history-layout">\n                </div>\n            </div>\n        `;const g=u.querySelectorAll(".tab");l.storeHistory&&(!l._currentUser||l._currentUser&&!l._currentUser.info?g[g.length-1].classList.add("smart-hidden"):g[g.length-1].classList.remove("smart-hidden")),!l.users||l.users&&0===l.users.length||!l._currentUser||l._currentUser&&!l._currentUser.info?g[g.length-2].classList.add("smart-hidden"):g[g.length-2].classList.remove("smart-hidden"),u.querySelector(".tabs").onpointerdown=e=>{const t=e.target.closest(".tab");if(t){const e=t.getAttribute("view"),a=u.querySelector(".details-tab"),i=u.querySelector(".comments-tab"),n=u.querySelector(".history-tab");a.classList.add("smart-hidden"),i.classList.add("smart-hidden"),n.classList.add("smart-hidden");for(let e=0;e<g.length;e++)g[e].classList.remove("active");switch(t.classList.add("active"),e){case"details":a.classList.remove("smart-hidden");break;case"comments":i.classList.remove("smart-hidden");break;case"history":n.classList.remove("smart-hidden"),l._refreshHistory()}}};const b=l._getColorInput();u.querySelector(".background").appendChild(b),b.onchange=()=>{i.background=b.value},i.background&&(b.value=i.background);const f=l._getColorInput();u.querySelector(".color").appendChild(f),f.onchange=()=>{i.color=f.value},i.color&&(f.value=i.color);const h=l._getColorInput();u.querySelector(".status").appendChild(h),h.onchange=()=>{i.status=h.value},i.status&&(h.value=i.status);const y=document.createElement("smart-input");y.style.width="auto",y.classList.add("underlined"),y.dropDownButtonPosition="right",y.readonly=!0,y.dropDownHeight="auto",y.dataSource=["-","Segoe UI","Arial","Georgia","Impact","Tahoma","Times New Roman","Verdana"],y.onchange=()=>{i.fontFamily=y.value},i.fontFamily?y.value=i.fontFamily:y.selectedIndex=0,u.querySelector(".font-family").appendChild(y);const v=document.createElement("smart-input");v.style.width="auto",v.classList.add("underlined"),v.dropDownButtonPosition="right",v.readonly=!0,v.dropDownHeight="auto",v.dataSource=["-","8px","10px","12px","14px","18px","24px","36px"],v.onchange=()=>{i.fontSize=v.value},i.fontSize?v.value=i.fontSize:v.selectedIndex=0,u.querySelector(".font-size").appendChild(v);const C=u.querySelector(".button-group");C.onclick=e=>{const t=e.target.closest(".formatbtn");let a;t.classList.contains("checked")?(t.classList.remove("checked"),a=!1):(t.classList.add("checked"),a=!0),t.classList.contains("bold")?i.fontWeight=a?"bold":null:t.classList.contains("italic")?i.fontStyle=a?"italic":null:t.classList.contains("underline")&&(i.textDecoration=a?"underline":null)},i.fontWeight?C.children[0].classList.add("checked"):C.children[0].classList.remove("checked"),i.fontStyle?C.children[1].classList.add("checked"):C.children[1].classList.remove("checked"),i.textDecoration?C.children[2].classList.add("checked"):C.children[2].classList.remove("checked"),u.querySelector(".reset-format").onclick=()=>{for(let e=0;e<C.children.length;e++)C.children[e].classList.remove("checked");y.selectedIndex=0,v.selectedIndex=0,f.value="",b.value="",h.value="",i.fontWeight=null,i.fontStyle=null,i.textDecoration=null,i.fontSize=null,i.fontFamily=null};const S=u.querySelector(".comments-header"),w=u.querySelector('[view="comments"]'),D=u.querySelector(".comments-layout smart-text-area"),_=u.querySelector(".comments-layout smart-button"),L=u.querySelector(".comments-layout .footer"),k=u.querySelector(".comments-layout .comments");D.users=l.users,_.disabled=!0,k.innerHTML=`<span class="no-comments">${l.localize("noComments")}</span>`;const x=()=>{const e=k.querySelector(".no-comments");0===n.length?e.classList.remove("smart-hidden"):e.classList.add("smart-hidden")},A=e=>{e.querySelector(".remove-button").onclick=e=>{const t=e.target,i=n.indexOf(t.comment);if(i>-1){const e=n[i];n.splice(i,1),l.$.fireEvent("commentRemove",{id:a.id,value:e}),l.onComment&&l.onComment(a.id,n),t.element.remove();const o=n.length?"("+n.length+")":"";S.innerHTML=w.innerHTML=`${l.localize("comments").replace(":","")} ${o}`}}};for(let e=0;e<n.length;e++){const t=n[e],a=l._createComment(t);A(a),k.appendChild(a)}S.innerHTML=`${l.localize("comments").replace(":","")} ${p}`,x(),D.onfocus=()=>{L.classList.add("focus")},D.onblur=()=>{L.classList.remove("focus")},D.onkeyup=()=>{_.disabled=""===D.value},_.onclick=()=>{if(""===D.value)return;l._refreshCurrentUser();const e={text:D.value,id:function(){const e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()}(),userId:l._currentUser.info?l._currentUser.info.id:-1,time:new Date},t=l._createComment(e);A(t),n.push(e),l.$.fireEvent("commentAdd",{id:a.id,value:e}),l.onComment&&l.onComment(a.id,n),D.value="",_.disabled=!0,x(),k.appendChild(t);const i=n.length?"("+n.length+")":"";S.innerHTML=w.innerHTML=`${l.localize("comments").replace(":","")} ${i}`};for(let e=0;e<l.columns.length;e++){const t=l.columns[e];if(!t.allowEdit||!1===t._visible)continue;const a=document.createElement("div");a.classList.add("smart-grid-edit-dialog-row"),r.appendChild(a);const i=document.createElement("div"),n=l._settingsDialogRowId?document.createElement("div"):document.createElement("label"),s=t.validationRules&&t.validationRules.length>0?"*":"";n.innerHTML=`<div class="smart-grid-edit-dialog-column-info"><span class="smart-grid-icon ${l.columns[e].icon} show"></span><label>`+l.columns[e].label+s+'</label><span toggle class="smart-grid-icon smart-icon-visibility-on show"</div>';const d=document.createElement("div");d.classList.add("smart-grid-dialog-editor"),d.setAttribute("editor",t.dataField),d.setAttribute("template",t.editor.template);const c=n.querySelector("[toggle]");c.column=t,o[t.dataField]=t.visible,c.title=l.localize("columnMenuItemHide"),!1===l.editing.enabled&&c.classList.add("smart-visibility-hidden"),c.onclick=()=>{o[c.column.dataField]=!c.column.visible,c.classList.contains("smart-icon-visibility-on")?(c.classList.remove("smart-icon-visibility-on"),c.classList.add("smart-icon-visibility-off"),c.title=l.localize("columnMenuItemShow")):(c.classList.add("smart-icon-visibility-on"),c.classList.remove("smart-icon-visibility-off"),c.title=l.localize("columnMenuItemHide"))},t.visible||(c.classList.remove("smart-icon-visibility-on"),c.title=l.localize("columnMenuItemShow")),t.visible?c.classList.add("smart-icon-visibility-on"):c.classList.add("smart-icon-visibility-off"),i.appendChild(n),i.appendChild(d);const u=document.createElement("label");u.classList.add("smart-field-editor-error-label"),u.setAttribute("label-for",t.dataField),i.appendChild(u),a.appendChild(i)}}_refreshHistory(){const e=this,t=e._dialogEdit;if(!t)return;const a=t.querySelector(".history-layout");if(!e.storeHistory)return void a.classList.add("smart-hidden");if(!e._currentUser||e._currentUser&&!e._currentUser.info)return void a.classList.add("smart-hidden");a.classList.remove("smart-hidden");const l=t.row.history;if(!l)return;let i="\n            ";for(let t=l.length-1;t>=0;t--){const a=l[t];let n="";if(e._kanban)n=e._kanban._getHistoryItemLabel(a);else if("created"===a.action)n=e.localize("rowCreated",{value:a.action});else{const t=e.columnByDataField[a.action];n=e.localize("propertyUpdated",{value:t?t.label:a.action})}if(i+='<div class="history-row">',void 0!==a.user){const t=(t=>{const a=t?t.image:null;return{image:a?`background-image: url('${a}');`:"",label:t?t.name||t.id:e.localize("guestUser"),cssClass:a?"image":""}})(e.users.find((e=>e.id===a.user)));i+=`<div class="history-user"><div class="user-icon smart-user ${t.cssClass}" style="${t.image}"></div><div class="user-name">${t.label}</div><div class="time">${new Smart.Utilities.DateTime(a.date).toString("dd/MM/yyyy hh:mm")}</div></div>`}else i+="<div></div>";if(i+='<div class="history-action">',i+=`<div>${n}</div>`,"created"!==a.action){let t=a.details.oldValue,l=a.details.value;if("user"===a.action){const a=e.users.find((e=>e.id===t||e.id===parseFloat(t))),i=e.users.find((e=>e.id===l||e.id===parseFloat(l)));a?t=a.name:(t="",t||(t=e.localize("unassigned"))),i?l=i.name:(l="",l||(l=e.localize("unassigned")))}if("subtasks"===a.action){let t=[];"string"==typeof a.details.value?a.details.value.split(",").forEach((e=>{e.indexOf(": Y")>=0&&t.push(e)})):t=a.details.value.filter((e=>e.completed)),e._kanban?i+=`<span class="detail smart-truncate">${e._kanban.localize("taskSubtasksCompleted",{value:t.length+"/"+a.details.value.length})}</span>`:i+=`<span class="detail smart-truncate">${e.localize("completed",{value:t.length})}</span>`}else{t&&"object"==typeof t&&t instanceof Date&&(t=t.toLocaleString()),l&&"object"==typeof l&&l instanceof Date&&(l=l.toLocaleString());let n=e.columnByDataField[a.action];n||(n=e.columnByDataField["task"+a.action.substring(0,1).toUpperCase()+a.action.substring(1)]),"user"===a.action&&(n=e.columnByDataField.taskUserId);let o="";n&&n.label&&(o='"'+n.label+'"'),n&&"date"===n.dataType?(t&&"string"==typeof t&&(t=new Date(t).toLocaleString()),l&&"string"==typeof l&&(l=new Date(l).toLocaleString())):(t&&"string"==typeof t&&(t=e._fromHTMLEntities(t)),l&&"string"==typeof l&&(l=e._fromHTMLEntities(l))),i+=t?`<span class="detail smart-truncate">${e.localize("range",{column:o,oldValue:t,newValue:l})}</span>`:`<span class="detail smart-truncate">${e.localize("nullRange",{column:o,oldValue:t,newValue:l})}</span>`}}else i+=`<div>${a.details.value}</div>`;i+="</div>\n                </div>"}i+="",a.innerHTML=i}_createComment(e){const t=this,a=t.users.find((t=>t.id===e.userId)),l=document.createElement("div"),i=a?a.name||a.id:t.localize("guestUser"),n=a?a.name:t.localize("guestUser"),o=a.image?a.image:"";e.text&&/<.+?>/.test(e.text)&&e.text.replace&&("all"===t.dataSourceSettings.sanitizeHTML?e.text=e.text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):"blackList"===t.dataSourceSettings.sanitizeHTML&&(e.text=window.Smart.Utilities.Core.escapeHTML(e.text)));let r=e.text;if(r.indexOf("@")>=0)for(let e=0;e<t.users.length;e++){const a=t.users[e];if(r.indexOf("@"+a.name)>=0){let e=`<div style="border:1px solid var(--smart-border); position:relative; top: -3px; border-radius: 15px; padding-right: 6px; background: var(--smart-surface); align-items: center; display: inline-flex;"><div class="user-icon smart-icon" role="img" aria-label="Icon of user ${a.name}"></div><span>${a.name}</span></div>`;a.image&&(e=`<div style="border:1px solid var(--smart-border); position:relative; top: -3px; border-radius: 15px; padding-right: 6px; background: var(--smart-surface); align-items: center; display: inline-flex;"><div style="width: 24px; height: 24px; background-image: url('${a.image}');" class="image user-icon smart-icon" role="img" aria-label="Icon of user ${a.name}"></div><span>${a.name}</span></div>`),r=r.replaceAll("@"+a.name,e)}}if(l.className="comment",l.setAttribute("role","listitem"),l.innerHTML=`<div class="comment-indent" role="presentation">\n<div class="user-icon smart-icon" role="img" aria-label="Icon of user ${i}"></div>\n</div>\n<div class="comment-main" role="presentation">\n<div class="comment-header" role="presentation">\n    <div class="user-name" aria-label="User name">${n}</div>\n    <div class="time" aria-label="Comment time">${e.time?new Smart.Utilities.DateTime(e.time).toString(t.formatStringTime):""}</div>\n    <div class="remove-button${t._currentUser.info&&a.id===t._currentUser.info.id&&t._currentUser.allowComment?" enabled":""}" role="button" aria-haspopup="menu" aria-label="Comment settings"></div>\n</div>\n<div class="comment-body" style="background: var(--smart-background); border-radius: var(--smart-border-radius); padding: 5px;" aria-label="Comment text">${r||""}</div >\n</div>`,o){const e=l.querySelector(".user-icon");e.style.backgroundImage=`url('${o}')`,e.classList.add("image")}l.comment=e;const s=l.querySelector(".remove-button");return s.comment=e,s.element=l,e.userId!==t._currentUser.info.id&&s.classList.add("smart-visibility-hidden"),l}_openSummaryRowDialog(e){const t=this,a=t._summaryRowDialog||t._createDialog(),l="{{message}}"===t.editing.dialog.header?t.localize("summary"):t.editing.dialog.header;if(a.header.innerHTML=l,!a.listBox){const e=document.createElement("smart-list-box");e.selectionMode="checkBox",e.style.borderColor="transparent",a.content.innerHTML="",a.listBox=e}const i=a.listBox;a.summaryValueElement&&a.summaryValueElement.classList.remove("summary-chooser");const n=e.element.querySelector(".summary-value");if(!n)return;n.classList.add("summary-chooser"),a.summaryValueElement=n;let o=[];a.dataField=e.column.dataField,"string"===e.column.dataType?(o=[{label:t.localize("countSummary"),value:"count"},{label:t.localize("blankSummary"),value:"blank"},{label:t.localize("filledSummary"),value:"filled"},{label:t.localize("uniqueSummary"),value:"unique"}],e.column.editor&&e.column.editor.dataSource&&e.column.editor.singleSelect&&o.push({label:t.localize("statusSummary"),value:"status"})):o="boolean"===e.column.dataType||"any"===e.column.dataType?[{label:t.localize("countSummary"),value:"count"},{label:t.localize("blankSummary"),value:"blank"},{label:t.localize("filledSummary"),value:"filled"}]:"date"===e.column.dataType?[{label:t.localize("countSummary"),value:"count"},{label:t.localize("blankSummary"),value:"blank"},{label:t.localize("filledSummary"),value:"filled"},{label:t.localize("uniqueSummary"),value:"unique"}]:[{label:t.localize("countSummary"),value:"count"},{label:t.localize("minSummary"),value:"min"},{label:t.localize("maxSummary"),value:"max"},{label:t.localize("sumSummary"),value:"sum"},{label:t.localize("avgSummary"),value:"avg"}],i.dataSource=o,i.style.position="absolute",i.style.visibility="hidden",i.style.height="auto",t.isInShadowDOM?t.getRootNode().appendChild(i):document.body.appendChild(i);const r=e.column;r.summary&&r.summary.forEach((e=>{i.select(e)}));const s=i.offsetHeight;a.column=r,a.content.appendChild(i),a.classList.add("smart-grid-dialog-summary"),a.header.parentElement.classList.add("smart-hidden"),a.footer.classList.add("smart-hidden"),i.style.visibility="",i.style.position="",i.style.width="100%",t._summaryRowDialog||(a.btnConfirm.innerHTML=t.localize("apply"),a.btnCancel.innerHTML=t.localize("cancel"),a.style.width=a.style.minWidth="120px",a.onOpen=function(){t.editing.dialog.visible=!0},a.onClose=function(){t.editing.dialog.visible=!1,a.summaryValueElement&&a.summaryValueElement.classList.remove("summary-chooser")},a.btnCancel.onclick=function(){a.close()},a.btnClose.onclick=function(){a.close()},a.btnConfirm.onclick=function(){const e=a.column.summary;a.column.summary=i.selectedValues,t.$.fireEvent("columnSummaryChange",{column:a.column,dataField:r.dataField,oldSummary:[...e],summary:[...a.column.summary]}),a.close(),t._calculateSummary(),t._recycle(!1)},a.confirm=function(){a.btnConfirm.click()},a.onkeydown=function(e){"Escape"===e.key&&a.close()},t._summaryRowDialog=a);const d=e.element,c=t.offset(d),u=t.offset(t);let m=d.offsetWidth+c.left-u.left-120;m<0&&(m=c.left-u.left),a.open(m,c.top-u.top-s-0),setTimeout((function(){a.btnConfirm.focus()}),100)}_openTextAreaDialog(e,t,a){const l=this,i=l._dialogTextArea||l._createDialog();if(i.header.innerHTML=e.label,i.column=e,i.classList.add("smart-grid-textarea-dialog"),i.style.minWidth="250px",i.style.minHeight="250px",i.style.zIndex=99999,i.textarea=t,i.initialValue=t.value,i.cell=a,!l._dialogTextArea){i.modal=!0,i.btnConfirm.innerHTML=l.localize("dialogEditButtonSave"),i.btnCancel.innerHTML=l.localize("dialogEditButtonCancel"),i.onOpen=function(){const e=i.querySelector("textarea");e.value=i.textarea.value,e.onchange=e.oninput=()=>{i.textarea.value=e.value},setTimeout((()=>{e.focus()}),250)},i.onClose=function(){};const e=()=>{const e=document.querySelector(".smart-grid-text-area-dialog");e&&e.remove()};i.btnCancel.onclick=function(){if(i.close(),l.editing.dialog.enabled)return i.textarea.value=i.initialValue,void e();l.cancelEdit(),e()},i.btnClose.onclick=function(){i.close()},i.btnConfirm.onclick=function(){if(i.close(),l.editing.dialog.enabled)return e(),void i.cell.editor.instance.setValue(i.textarea.value);i.cell.editor.instance.setValue(i.textarea.value),e(),l.endEdit()},i.onkeydown=function(e){"Escape"===e.key&&i.close()},l._dialogTextArea=i;const t=document.createElement("smart-text-area");t.classList.add("smart-text-area"),t.resize="both",t.users=l.users,t.style.resize="both",t.style.minWidth="250px",t.style.minHeight="250px",t.style.width="450px",t.style.height="400px",i.content.appendChild(t)}const n=l.offset(t),o=l.offset(l);i.open(n.left-o.left+e.computedWidth,n.top-o.top),setTimeout((function(){i.btnConfirm.focus()}),100)}_openDescriptionDialog(e,t){const a=this,l=a._dialogDescription||a._createDialog(),i=a.localize("dialogDescriptionHeader",{value:e.label});if(l.header.innerHTML=i,l.column=e,l.command=t,l.classList.add("smart-grid-dialog-add-column"),!a._dialogDescription){l.modal=!0,l.btnConfirm.innerHTML=a.localize("dialogEditButtonConfirm"),l.btnCancel.innerHTML=a.localize("dialogEditButtonCancel"),l.onOpen=function(){const e=l.querySelector("smart-input");"duplicate"!==t&&setTimeout((()=>{e.select()}),250)},l.onClose=function(){},l.btnCancel.onclick=function(){l.close()},l.btnClose.onclick=function(){l.close()},l.btnConfirm.onclick=function(){const e=l.querySelector("smart-input");switch(l.command){case"duplicate":0===e.selectedIndex?a.duplicateCommand(l.column,null,!0):a.duplicateCommand(l.column,null,!1);break;case"rename":l.column.label=e.value;break;case"editDescription":l.column.description=e.value}l.close()},l.onkeydown=function(e){"Escape"===e.key&&l.close()},a._dialogDescription=l;const e=document.createElement("smart-input");e.classList.add("underlined"),e.dataSource="duplicate"!==t?[]:[{label:a.localize("duplicateCells"),value:"cells"},{label:a.localize("duplicateSettings"),value:"settings"}],l.content.appendChild(e)}const n=e.element,o=a.offset(n),r=a.offset(a);l.open(o.left-r.left,o.top+n.offsetHeight-r.top);const s=l.querySelector("smart-input");switch(s.selectedIndex=0,s.readonly=!0,s.dropDownButtonPosition="right",t){case"rename":s.value=e.label;break;case"editDescription":s.value=e.description}setTimeout((function(){l.btnConfirm.focus()}),100)}_openDeleteRowDialog(e,t){const a=this;if(!a.editing.deleteDialog.enabled)return!1;const l=a._dialogDelete||a._createDialog(),i="{{message}}"===a.editing.dialog.header?a.localize("dialogDeleteHeader",{value:e.visibleIndex+1}):a.editing.dialog.header;l.header.innerHTML=i,l.content.innerHTML=a.localize("dialogDeleteContent"),l.row=e,a._dialogDelete||(l.modal=!0,l.btnConfirm.innerHTML=a.localize("dialogDeleteButtonConfirm"),l.btnCancel.innerHTML=a.localize("dialogDeleteButtonCancel"),l.onOpen=function(){a.editing.dialog.visible=!0},l.onClose=function(){a.editing.dialog.visible=!1},l.btnCancel.onclick=function(){l.close()},l.btnClose.onclick=function(){l.close()},l.btnConfirm.onclick=function(){t(l.row),l.close()},l.onkeydown=function(e){"Escape"===e.key&&l.close()},a._dialogDelete=l),l.open(),setTimeout((function(){l.btnConfirm.focus()}),100)}_getTypesList(){const e=this,t=[{value:"string",prefix:'<span class="smart-grid-icon visible smart-icon-font"></span>',label:e.localize("dialogAddColumnTypeText")},{value:"multiText",prefix:'<span class="smart-grid-icon visible smart-icon-fontsize"></span>',label:e.localize("dialogAddColumnTypeMultilineText")},{value:"image",prefix:'<span class="smart-grid-icon visible smart-icon-image"></span>',label:e.localize("dialogAddColumnTypeImage")},{value:"number",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:e.localize("dialogAddColumnTypeNumber")},{value:"select",prefix:'<span class="smart-grid-icon visible smart-icon-sort-down"></span>',label:e.localize("dialogAddColumnTypeSelect")},{value:"multiSelect",prefix:'<span class="smart-grid-icon visible smart-icon-list-unordered"></span>',label:e.localize("dialogAddColumnTypeMultipleSelect")},{value:"boolean",prefix:'<span class="smart-grid-icon visible smart-icon-check-squared"></span>',label:e.localize("dialogAddColumnTypeCheckBox")},{value:"attachment",prefix:'<span class="smart-grid-icon visible smart-icon-docs"></span>',label:e.localize("dialogAddColumnTypeAttachment")},{value:"date",prefix:'<span class="smart-grid-icon visible smart-icon-calendar"></span>',label:e.localize("dialogAddColumnTypeDate")},{value:"duration",prefix:'<span class="smart-grid-icon visible smart-icon-calendar"></span>',label:e.localize("dialogAddColumnTypeDuration")},{value:"time",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:e.localize("dialogAddColumnTypeTime")},{value:"createdTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:e.localize("dialogAddColumnTypeCreatedTime")},{value:"updatedTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:e.localize("dialogAddColumnTypeLastUpdatedTime")},{value:"createdBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeCreatedBy")},{value:"updatedBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeLastUpdatedBy")},{value:"collaborator",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:e.localize("dialogAddColumnTypeCollaborator")},{value:"slider",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:e.localize("dialogAddColumnTypeSlider")},{value:"autoNumber",prefix:'<span class="smart-grid-icon visible smart-icon-list-ordered"></span>',label:e.localize("dialogAddColumnTypeAutoNumber")},{value:"url",prefix:'<span class="smart-grid-icon visible smart-icon-link"></span>',label:e.localize("dialogAddColumnTypeURL")},{value:"email",prefix:'<span class="smart-grid-icon visible smart-icon-mail"></span>',label:e.localize("dialogAddColumnTypeEmail")},{value:"phone",prefix:'<span class="smart-grid-icon visible smart-icon-phone"></span>',label:e.localize("dialogAddColumnTypePhone")},{value:"password",prefix:'<span class="smart-grid-icon visible smart-icon-lock"></span>',label:e.localize("dialogAddColumnTypePassword")},{value:"rating",prefix:'<span class="smart-grid-icon visible smart-icon-star"></span>',label:e.localize("dialogAddColumnTypeRating")}];if(e.header.visible&&e.header.buttons.indexOf("views")>=0){const a={value:"progress",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:e.localize("dialogAddColumnTypeProgress")},l={value:"priority",prefix:'<span class="smart-grid-icon visible smart-icon-sort-down"></span>',label:e.localize("dialogAddColumnTypePriority")},i={value:"status",prefix:'<span class="smart-grid-icon visible smart-icon-sort-down"></span>',label:e.localize("status")},n={value:"tags",prefix:'<span class="smart-grid-icon visible smart-icon-list-unordered"></span>',label:e.localize("dialogAddColumnTypeTags")},o={value:"checklist",prefix:'<span class="smart-grid-icon visible smart-icon-list-ordered"></span>',label:e.localize("dialogAddColumnTypeChecklist")},r={value:"color",prefix:'<span class="smart-grid-icon visible smart-icon-color-background"></span>',label:e.localize("dialogAddColumnTypeColor")};t.push(a),t.push(l),t.push(n),t.push(o),t.push(r),t.push(i)}return t}_getAddStackColumnDialogTemplate(){const e=this,t=[];let a=!1,l="";for(let i=0;i<e.columns.length;i++){const n=e.columns[i];(n.statusColumn||"taskStatus"===n.dataField||"taskStatus"===n._dataField||n.editor&&n.editor.dataSource&&n.editor.dataSource.length&&n.editor.singleSelect)&&(t.push({label:n.label,value:n.dataField}),e._stackedBy===n.dataField&&(t[t.length-1].checked=!0,a=!0,l=t[t.length-1].label))}const i=t.concat([{value:"blank",label:e.localize("kanbanNone")},{value:"basic",label:e.localize("kanbanBasic")}]);return a||(i[0].checked=!0,l=i[0].label),[{bind:"kanban",name:"kanban",type:"radio",label:2===i.length?e.localize("kanbanNoneDescription"):e.localize("kanbanDescription",{column:l}),filter:"kanban",options:i},{bind:"kanbanNotes",name:"kanbanNotes",type:"label",label:e.localize("dialogAddColumnStatusNotes"),filter:"kanban"},{bind:"name",type:"input",label:e.localize("dialogAddColumnName"),filter:"any",placeholder:e.localize("dialogAddColumnNamePlaceholder"),info:e.localize("dialogAddColumnNameInfo")},{bind:"allowColorItems",type:"boolean",label:e.localize("dialogAddColumnColorItems"),filter:"list, collaborator",value:!0,info:""},{bind:"options",name:"listitems",type:"items",label:e.localize("dialogAddColumnListItems"),filter:"list",info:""}]}_getAddColumnDialogTemplate(){const e=this,t=(new Date).getFullYear().toString(),a=new Date(t,6,30);return[{bind:"kanban",name:"kanban",type:"radio",label:e.localize("kanbanNoneDescription"),filter:"kanban",options:[{value:"blank",checked:!0,label:e.localize("kanbanNone")},{value:"basic",label:e.localize("kanbanBasic")}]},{bind:"kanbanNotes",name:"kanbanNotes",type:"label",label:e.localize("dialogAddColumnStatusNotes"),filter:"kanban"},{bind:"name",type:"input",label:e.localize("dialogAddColumnName"),filter:"any",placeholder:e.localize("dialogAddColumnNamePlaceholder"),info:e.localize("dialogAddColumnNameInfo")},{bind:"description",type:"input",label:e.localize("dialogAddColumnDescription"),filter:"any",placeholder:e.localize("dialogAddColumnDescriptionPlaceholder"),info:e.localize("dialogAddColumnDescriptionInfo")},{bind:"type",name:"typeslist",type:"dropDownList",filter:"any",label:e.localize("dialogAddColumnType"),icon:"smart-icon-font",options:e._getTypesList(),info:e.localize("dialogAddColumnTypeInfo")},{bind:"dateFormat",name:"dateformat",type:"dropDownList",label:e.localize("dialogAddColumnDateFormat"),options:[{value:"M/d/yyyy",label:e.localize("dialogAddColumnDateFormatShort")+" ("+new Smart.Utilities.DateTime(a).toString("d")+")"},{value:"dddd, MMMM dd, yyyy",label:e.localize("dialogAddColumnDateFormatLong")+" ("+new Smart.Utilities.DateTime(a).toString("D")+")"},{value:"yyyy-MM-ddTHH:mm:ss.sssZ",label:e.localize("dialogAddColumnDateFormatISO")+"  ("+new Smart.Utilities.DateTime(a).toString("ISO8601")+")"},{value:"d/M/yyyy",label:e.localize("dialogAddColumnDateFormatEU")+" (30/7/"+t+")"},{value:"yyyy-MM-dd",label:e.localize("dialogAddColumnDateFormatAS")+" ("+t+"-30-07)"},{value:"MMMM, dd, yyyy",label:e.localize("dialogAddColumnDateFormatFull")+" (July, 30, "+t+")"}],filter:"date",info:e.localize("dialogAddColumnDateFormatInfo")},{bind:"timeFormat",name:"timeformat",type:"dropDownList",label:e.localize("dialogAddColumnTimeFormat"),filter:"time",width:"50%",options:[{value:"hh:mm tt",label:"12 "+e.localize("dialogAddColumnTimeFormatHour")},{value:"HH:mm",label:"24 "+e.localize("dialogAddColumnTimeFormatHour")}],info:e.localize("dialogAddColumnTimeFormatInfo")},{bind:"allowTimeFormat",type:"boolean",label:e.localize("dialogAddColumnAllowTimeFormat"),filter:"date",width:"50%",value:!1,info:""},{bind:"allowCustomDateSeparator",type:"boolean",label:e.localize("dialogAddColumnCustomDateSeparator"),filter:"date",width:"50%",value:!1,info:""},{bind:"dateFormatSeparator",name:"dateFormatSeparator",type:"radio",label:"",filter:"date",width:"100%",columns:3,options:[{value:"/",label:e.localize("dialogAddColumnDateFormatSlash")+" (/)"},{value:"-",label:e.localize("dialogAddColumnDateFormatHyphen")+" (-)"},{value:".",label:e.localize("dialogAddColumnDateFormatDot")+" (.)"}]},{bind:"numberFormat",name:"numberFormat",type:"dropDownList",label:e.localize("dialogAddColumnNumberFormat"),filter:"number",options:[{value:{style:"decimal",maximumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatInteger")+" 1,000"},{value:{style:"decimal",minimumFractionDigits:2},label:e.localize("dialogAddColumnNumberFormatNumber")+" 1,000.12"},{value:{style:"percent",minimumFractionDigits:2},label:e.localize("dialogAddColumnNumberFormatPercent")+" 10.12%"},{value:{style:"percent",maximumFractionDigits:0,minimumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatPercentRounded")+" 10%"},{value:{style:"decimal",notation:"scientific"},label:e.localize("dialogAddColumnNumberFormatScientific")+" 1.01E+03"},{value:{style:"decimal",notation:"engineering"},label:e.localize("dialogAddColumnNumberFormatEngineering")+" 34.284 x 10^9"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,currencySign:"accounting"},label:e.localize("dialogAddColumnNumberFormatAccounting")+" $(1,000.12)"},{value:{style:"unit",unit:"kilogram"},label:e.localize("dialogAddColumnNumberFormatUnit")+" 10.12 kg"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency},label:e.localize("dialogAddColumnNumberFormatCurrency")+" $1,000.12"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,maximumFractionDigits:0,minimumFractionDigits:0},label:e.localize("dialogAddColumnNumberFormatCurrencyRounded")+"  $1,000"}],required:!1,info:e.localize("dialogAddColumnNumberFormatInfo")},{bind:"currency",name:"currency",type:"dropDownList",filter:"number",required:!1,options:e._getCurrencies(),label:e.localize("dialogAddColumnNumberFormatCurrency"),info:e.localize("dialogAddColumnNumberFormatCurrencyInfo")},{bind:"unit",name:"unit",type:"dropDownList",filter:"number",required:!1,options:[{value:"acre",label:e.localize("dialogAddColumnNumberFormatUnitAcre")},{value:"percent",label:e.localize("dialogAddColumnNumberFormatUnitPercent")},{value:"degree",label:e.localize("dialogAddColumnNumberFormatUnitDegree")},{value:"megabyte",label:e.localize("dialogAddColumnNumberFormatUnitMegaByte")},{value:"centimeter",label:e.localize("dialogAddColumnNumberFormatUnitCentimeter")},{value:"meter",label:e.localize("dialogAddColumnNumberFormatUnitMeter")},{value:"kilometer",label:e.localize("dialogAddColumnNumberFormatUnitKilometer")},{value:"mile",label:e.localize("dialogAddColumnNumberFormatUnitMile")},{value:"celsius",label:e.localize("dialogAddColumnNumberFormatUnitCelsius")},{value:"fahrenheit",label:e.localize("dialogAddColumnNumberFormatUnitFahrenheit")},{value:"kilogram",label:e.localize("dialogAddColumnNumberFormatUnitKilogram")},{value:"pound",label:e.localize("dialogAddColumnNumberFormatUnitPound")},{value:"liter",label:e.localize("dialogAddColumnNumberFormatUnitLiter")},{value:"gallon",label:e.localize("dialogAddColumnNumberFormatUnitGallon")},{value:"second",label:e.localize("dialogAddColumnNumberFormatUnitSecond")},{value:"minute",label:e.localize("dialogAddColumnNumberFormatUnitMinute")},{value:"hour",label:e.localize("dialogAddColumnNumberFormatUnitHour")},{value:"day",label:e.localize("dialogAddColumnNumberFormatUnitDay")},{value:"week",label:e.localize("dialogAddColumnNumberFormatUnitWeek")},{value:"month",label:e.localize("dialogAddColumnNumberFormatUnitMonth")},{value:"year",label:e.localize("dialogAddColumnNumberFormatUnitYear")}],label:e.localize("dialogAddColumnNumberFormatUnit"),info:e.localize("dialogAddColumnNumberFormatUnitInfo")},{bind:"allowThousandsSeparator",name:"allowThousandsSeparator",type:"boolean",label:e.localize("dialogAddColumnNumberFormatSeparator"),filter:"number",value:!0,info:""},{bind:"minLength",name:"minlength",width:"50%",type:"number",filter:"text",required:!1,label:e.localize("dialogAddColumnMinLength"),info:e.localize("dialogAddColumnMinLengthInfo")},{bind:"maxLength",name:"maxlength",width:"50%",filter:"text",type:"number",required:!1,label:e.localize("dialogAddColumnMaxLength"),info:e.localize("dialogAddColumnMaxLengthInfo")},{bind:"minValue",name:"minvalue",width:"50%",filter:"number",type:"number",required:!1,label:e.localize("dialogAddColumnMinValue"),info:e.localize("dialogAddColumnMinValueInfo")},{bind:"maxValue",name:"maxvalue",width:"50%",filter:"number",type:"number",required:!1,label:e.localize("dialogAddColumnMaxValue"),info:e.localize("dialogAddColumnMaxValueInfo")},{bind:"minDateTime",name:"mindatetime",type:"datetime",filter:"date",width:"50%",label:e.localize("dialogAddColumnMinDate"),info:e.localize("dialogAddColumnMinDateInfo")},{bind:"maxDateTime",name:"maxdatetime",type:"datetime",width:"50%",filter:"date",label:e.localize("dialogAddColumnMaxDate"),info:e.localize("dialogAddColumnMaxDateInfo")},{bind:"deadline",name:"deadline",type:"dropDownList",label:e.localize("dialogAddColumnTypeDueDateSettings"),info:e.localize("dialogAddColumnTypeDueDateSettingsInfo"),filter:"date",options:[{value:"",label:e.localize("dialogAddColumnTypeNone")},{value:"dueDate",label:e.localize("dialogAddColumnTypeDueDate")},{value:"startDate",label:e.localize("dialogAddColumnTypeStartDate")}]},{bind:"deadlineStatus",name:"deadlineStatus",type:"dropDownList",label:e.localize("dialogAddColumnTypeStatus"),info:e.localize("dialogAddColumnTypeStatusInfo"),filter:"date",options:[]},{bind:"deadlineDueDate",name:"deadlineDueDate",type:"dropDownList",label:e.localize("dialogAddColumnTypeDueDate"),info:"",filter:"date",options:[]},{bind:"allowColorItems",type:"boolean",label:e.localize("dialogAddColumnColorItems"),filter:"list, collaborator",value:!0,info:""},{bind:"allowCheckItems",type:"boolean",filter:"hidden",value:!1,label:e.localize("dialogAddColumnCheckItems"),info:""},{bind:"allowMultipleCollaborators",type:"boolean",filter:"collaborator",value:!1,label:e.localize("dialogAddColumnMultipleCollaborators"),info:e.localize("dialogAddColumnMultipleCollaboratorsInfo")},{bind:"options",name:"listitems",type:"items",label:e.localize("dialogAddColumnListItems"),filter:"list",info:""},{bind:"users",name:"users",type:"items",label:e.localize("dialogAddColumnListItems"),filter:"collaborator",info:""},{name:"align",bind:"cellsAlign",type:"dropDownList",label:e.localize("dialogAddColumnAlign"),required:!1,options:[{value:"left",label:e.localize("dialogAddColumnAlignLeft")},{value:"right",label:e.localize("dialogAddColumnAlignRight")},{value:"center",label:e.localize("dialogAddColumnAlignCenter")}],filter:"any",info:e.localize("dialogAddColumnAlignInfo")},{bind:"defaultString",name:"defaultString",type:"input",filter:"text",required:!1,label:e.localize("dialogAddColumnDefault")},{bind:"defaultNumber",name:"defaultNumber",type:"number",filter:"number",required:!1,label:e.localize("dialogAddColumnDefault")},{bind:"defaultDate",name:"defaultDate",type:"dropDownList",label:e.localize("dialogAddColumnDefault"),filter:"date",options:[{value:"current",label:e.localize("dialogAddColumnDefaultDateCurrent")},{value:"specific",label:e.localize("dialogAddColumnDefaultDateSpecific")}]},{bind:"defaultDateValue",name:"defaultDateValue",type:"datetime",filter:"date",label:e.localize("placeholderValue")},{bind:"setDefaultValue",type:"boolean",label:e.localize("dialogAddColumnDefault"),width:"50%",filter:"any",value:!1,info:""},{bind:"allowResize",type:"boolean",filter:"any",width:"50%",label:e.localize("dialogAddColumnResizable"),info:e.localize("dialogAddColumnResizableInfo")},{bind:"required",type:"boolean",width:"50%",filter:"any",value:!1,label:e.localize("dialogAddColumnRequired"),info:e.localize("dialogAddColumnRequiredInfo")},{bind:"allowSort",type:"boolean",width:"50%",filter:"any",label:e.localize("dialogAddColumnSortable"),info:e.localize("dialogAddColumnSortableInfo")},{bind:"allowFilter",type:"boolean",align:"left",width:"50%",filter:"any",label:e.localize("dialogAddColumnFilterable"),info:e.localize("dialogAddColumnFilterableInfo")},{bind:"allowEdit",type:"boolean",width:"50%",filter:"any",label:e.localize("dialogAddColumnEditable"),info:e.localize("dialogAddColumnEditableInfo")}]}_getKanbanFields(){return["startDate","dueDate","progress","checklist","priority","tags","name","color","description","status"]}_addColumnDialogShowHideEditors(e){const t=this,a=e.editColumn,l=e.querySelector('[bind="type"]'),i=l?l.querySelector("smart-input"):null,n=l?i.getSelectedItem().value:"kanban",o=e.querySelectorAll(".smart-grid-dialog-editor"),r=t._getKanbanFields(),s=e.querySelector('[field-name="kanbanNotes"]');s&&("kanban"!==t.view?s.classList.add("smart-hidden"):s.classList.remove("smart-hidden"));const d=t=>{const a=e.querySelector('[field-name="defaultDate"]'),l=e.querySelector('[field-name="defaultDateValue"]');if(!t)return a.classList.add("smart-hidden"),void l.classList.add("smart-hidden");a.classList.remove("smart-hidden"),"specific"===t?(l.classList.remove("smart-hidden"),l.style.width="50%",l.style.float="left",a.style.width="50%",a.style.float="left",a.style.clear="both"):(l.classList.add("smart-hidden"),l.style.width="",l.style.float="",a.style.width="",a.style.float="")};let c=!!a;if(a){switch(e.columnType||n){case"createdTime":case"updatedTime":case"createdBy":case"updatedBy":case"autoNumber":case"image":case"progress":case"color":case"rating":case"collaborator":case"attachment":c=!0;break;default:c=!1}"checklist"!==a.template&&"color"!==a.template||(c=!0)}for(let l=0;l<o.length;l++){const i=o[l],s=i.getAttribute("filter"),u=i.getAttribute("bind"),m=i.parentNode;if("deadlineStatus"!==u&&"deadlineDueDate"!==u)if(m.classList.add("smart-hidden"),"cellsAlign"===u&&("boolean"===n||"attachment"===n||"image"===n||"email"===n||"url"===n||"collaborator"===n||"createdBy"===n||"password"===n||"phone"===n||"createdTime"===n||"updatedBy"===n||"updatedTime"===n||r.indexOf(n)>=0))m.classList.add("smart-hidden");else if("type"===u&&c)m.classList.add("smart-hidden");else if("allowEdit"!==u||!1!==t.editing.enabled&&"autoNumber"!==n&&"createdBy"!==n&&"updatedBy"!==n&&"createdTime"!==n&&"updatedTime"!==n)if("allowResize"!==u||"none"!==t.behavior.columnResizeMode)if("allowFilter"!==u||!1!==t.filtering.enabled)if("allowSort"!==u||!1!==t.sorting.enabled)if("required"!==u||!1!==t.editing.enabled&&("string"===n||"multiText"===n||"name"===n||"description"===n||"select"===n||"collaborator"===n||"multiSelect"===n||"select"===n||"priority"===n))if(a&&a.disabledDialogOptions&&a.disabledDialogOptions.length>0&&a.disabledDialogOptions.indexOf(u)>=0)m.classList.add("smart-hidden");else{if(a&&"kanban"===t.view){switch(u){case"options":case"allowColorItems":case"allowSort":case"allowFilter":case"align":case"cellsAlign":case"allowResize":case"allowEdit":m.classList.add("smart-hidden");continue}"kanban"===t.view&&"kanban"===s&&m.classList.remove("smart-hidden")}if("deadline"!==u)if("setDefaultValue"!==u){if(a&&a.editor&&a.editor.collaborator)switch(u){case"options":m.classList.add("smart-hidden");continue;case"users":m.classList.remove("smart-hidden");continue}if("name"!==u||"kanban"!==t.view)if("any"!==s)switch(n){default:case"text":"text"===s&&m.classList.remove("smart-hidden"),a&&"any"===a.dataType&&m.classList.add("smart-hidden");break;case"slider":case"number":if("number"===s&&m.classList.remove("smart-hidden"),"unit"===u||"currency"===u||"allowThousandsSeparator"===u){m.classList.add("smart-hidden");const t=e.querySelector('[field-name="allowThousandsSeparator"]'),a=e.querySelector('[field-name="numberFormat"]'),l=e.querySelector('[field-name="unit"]'),i=e.querySelector('[field-name="currency"]'),n=a.querySelector("smart-input"),o=()=>{const e=n.getSelectedItem();i.classList.add("smart-hidden"),t.classList.add("smart-hidden"),e&&"decimal"===e.value.style&&!e.value.notation&&t.classList.remove("smart-hidden"),e&&"unit"===e.value.style?l.classList.remove("smart-hidden"):e&&"currency"===e.value.style?i.classList.remove("smart-hidden"):l.classList.add("smart-hidden")};a.onchange=()=>{o()},o()}break;case"select":case"multiSelect":s.indexOf("list")>=0&&m.classList.remove("smart-hidden");break;case"collaborator":s.indexOf("collaborator")>=0&&m.classList.remove("smart-hidden");break;case"createdBy":case"updatedBy":case"autoNumber":case"createdTime":case"updatedTime":case"url":case"email":case"image":case"attachment":case"phone":case"password":case"progress":case"checklist":case"priority":case"tags":case"name":case"description":case"assigned":case"status":case"color":case"boolean":if("status"===n||"priority"===n||"tags"===n){s.indexOf("list")>=0&&m.classList.remove("smart-hidden");break}break;case"time":{const t=e.querySelector('[field-filter="time"]');t.classList.remove("smart-hidden"),t.style.width="",t.style.float="";break}case"duration":break;case"dueDate":case"startDate":case"date":{const t=e.querySelector('[field-name="dateFormat"]').querySelector(".smart-input").value;if("defaultDate"===u||"defaultDateValue"===u){const t=e.querySelector('[field-name="defaultDate"]'),l=e.querySelector('[field-name="defaultDateValue"]'),i=t.querySelector(".smart-input"),n=l.querySelector(".smart-input");a&&a.defaultValue?"today"===a.defaultValue?(i.selectedValues=["current"],n.value=null):(i.selectedValues=["specific"],n.value=a.defaultValue):(i.selectedValues=["current"],n.value=null),d(i.selectedValue)}"date"===s&&m.classList.remove("smart-hidden");const l=t=>{const a=e.querySelector('[field-filter="time"]'),l=e.querySelector('[field-name="dateFormat"]');t?(a.classList.remove("smart-hidden"),l.style.width="50%",l.style.float="left"):(a.classList.add("smart-hidden"),l.style.width="",l.style.float="")},n=t=>{const a=e.querySelector('[field-name="allowTimeFormat"]'),l=a.querySelector(".smart-grid-dialog-editor");t.indexOf("T")>=0?(a.classList.add("smart-hidden"),l.uncheck()):a.classList.remove("smart-hidden")},o=t=>{const a=e.querySelector('[field-name="dateFormatSeparator"]');t?a.classList.remove("smart-hidden"):a.classList.add("smart-hidden")};if("allowTimeFormat"===u){const e=i.querySelector(".smart-input").value;i.onchange=e=>{l(e)},l(e)}if("dateFormat"===u){const e=i.querySelector(".smart-input").value;i.onchange=e=>{n(e.detail.value)},n(e)}if("defaultDate"===u){const e=i.querySelector(".smart-input").value;i.onchange=e=>{d(e.detail.value)},d(e)}if("dateFormatSeparator"===u){const t=e.querySelector('[field-name="allowCustomDateSeparator"]').querySelector(".smart-input").value;o(t)}if("allowCustomDateSeparator"===u){t.indexOf("T")>=0&&t.indexOf("-")>0&&i.uncheck();const e=i.querySelector(".smart-input").value;i.onchange=e=>{o(e)},o(e)}n(t);break}}else m.classList.remove("smart-hidden");else{const e=t._getAddStackColumnDialogTemplate().find((e=>{if("kanban"===e.bind)return e}));e.options[e.options.length-1].checked||e.options[e.options.length-2].checked?i.classList.remove("smart-hidden"):i.classList.add("smart-hidden")}}else{switch(a&&a.defaultValue&&m.classList.remove("smart-hidden"),n){case"string":case"multiText":case"name":case"description":case"multiSelect":case"boolean":case"date":case"dueDate":case"startDate":case"collaborator":case"number":case"priority":case"status":case"select":m.classList.remove("smart-hidden");break;default:m.classList.add("smart-hidden")}const t=t=>{const a=e.querySelector('[bind="type"]'),l=a?a.querySelector("smart-input"):null,i=a?l.getSelectedItem().value:"kanban",n=e.querySelector('[field-name="defaultDate"]'),o=e.querySelector('[field-name="defaultNumber"]'),r=e.querySelector('[field-name="defaultString"]'),s=e.querySelector('[field-name="defaultDateValue"]'),c=e.querySelectorAll(".smart-default-item-container");n&&(n.classList.add("smart-hidden"),s.classList.add("smart-hidden")),o&&o.classList.add("smart-hidden"),r&&r.classList.add("smart-hidden");for(let e=0;e<c.length;e++)c[e].classList.add("smart-hidden");if(t)if("date"===i||"dueDate"===i||"startDate"===i){if(n){n.classList.remove("smart-hidden"),s.classList.remove("smart-hidden");const e=n.querySelector("smart-input").selectedValues;d(e&&e.length?e[0]:"current")}}else if("number"===i||"slider"===i)o&&o.classList.remove("smart-hidden");else if("string"===i||"multiText"===i||"name"===i||"description"===i)r&&r.classList.remove("smart-hidden");else for(let e=0;e<c.length;e++)c[e].classList.remove("smart-hidden")};i.onchange=e=>{t(e)};const l=e.querySelector('[field-name="setDefaultValue"]'),o=!(!a||null===a.defaultValue||void 0===a.defaultValue)||l.value;t(o)}else m.classList.add("smart-hidden"),t.header.visible&&t.header.buttons.indexOf("views")>=0&&"date"===n&&m.classList.remove("smart-hidden")}else m.classList.add("smart-hidden");else m.classList.add("smart-hidden");else m.classList.add("smart-hidden");else m.classList.add("smart-hidden");else m.classList.add("smart-hidden")}}_addColumnDialogInitEditors(e,t,a){const l=this,i=e.editColumn,n=()=>{const e=a.deadline.parentElement.querySelector(".smart-input"),t=a.deadlineStatus.parentElement,l=a.deadlineDueDate.parentElement,i=t.querySelector("smart-input"),n=l.querySelector("smart-input");t.classList.add("smart-hidden"),l.classList.add("smart-hidden"),2===e.selectedIndex?l.classList.remove("smart-hidden"):1===e.selectedIndex&&t.classList.remove("smart-hidden"),i.dataSource&&0===i.dataSource.length&&t.classList.add("smart-hidden"),n.dataSource&&0===n.dataSource.length&&l.classList.add("smart-hidden")};for(let o in a){const r=a[o],s=r.querySelector("input"),d=r.querySelector("smart-input");switch(o){case"allowTimeFormat":{const e=r.querySelector(".smart-input");i&&i.editor?"dateInput"===i.editor.template?(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked","")):(e.value=!1,e.removeAttribute("checked"));break}case"allowCustomDateSeparator":{const e=r.querySelector(".smart-input");e.value=!1,e.removeAttribute("checked");let t=0;i&&i.cellsFormat&&(i.cellsFormat.indexOf(".")>=0?(e.value=!0,e.setAttribute("checked",""),t=2):(i.cellsFormat.indexOf("M-d-yyyy")>=0||i.cellsFormat.indexOf("d-M-yyyy")>=0||i.cellsFormat.indexOf("yyyy/MM/dd")>=0)&&(e.value=!0,e.setAttribute("checked",""),t=1));const l=a.dateFormatSeparator.querySelectorAll(".smart-grid-dialog-boolean-field");l.forEach((e=>{e.value=!1,e.removeAttribute("checked")})),l[t].setAttribute("checked",""),l[t].click(),l[t].value=!0;break}case"kanban":{const t=r.querySelectorAll(".smart-grid-dialog-boolean-field");for(let a=0;a<t.length;a++){const i=t[a];i.onchange=a=>{const n=[...a.parentElement.children].indexOf(a),o=a.parentElement.parentElement.previousElementSibling,r=e.querySelector('[field-name="options"]'),s=e.querySelector('[field-name="allowColorItems"]'),d=e.querySelector('[field-name="name"]'),c=()=>{const t=r.querySelector("smart-sortable");t&&(t._validate(),e&&e.offsetHeight&&e.setPosition("center"))};n===t.length-1?(o.innerHTML=l.localize("kanbanBasicDescription"),s.classList.remove("smart-hidden"),r.classList.remove("smart-hidden"),d.classList.remove("smart-hidden"),d.querySelector(".smart-grid-dialog-editor ").classList.remove("smart-hidden"),d.querySelector("smart-input").value=l.localize("dialogNewColumn"),c()):n===t.length-2?(o.innerHTML=l.localize("kanbanNoneDescription"),s.classList.add("smart-hidden"),r.classList.add("smart-hidden"),d.classList.remove("smart-hidden"),d.querySelector(".smart-grid-dialog-editor ").classList.remove("smart-hidden"),d.querySelector("smart-input").value=l.localize("dialogNewColumn"),c()):(o.innerHTML=l.localize("kanbanDescription",{column:i.label.innerHTML}),s.classList.add("smart-hidden"),r.classList.remove("smart-hidden"),r.classList.add("smart-hidden"),d.classList.add("smart-hidden"),d.querySelector("smart-input").value=i.label.innerHTML,d.querySelector(".smart-grid-dialog-editor").classList.add("smart-hidden"),c())}}break}case"dateFormat":i&&i.cellsFormat?i.cellsFormat.indexOf("M/d/yyyy")>=0?d.selectedIndex=0:i.cellsFormat.indexOf("dddd, MMMM dd, yyyy")>=0?d.selectedIndex=1:i.cellsFormat.indexOf("yyyy-MM-ddTHH:mm:ss.sssZ")>=0?d.selectedIndex=2:i.cellsFormat.indexOf("d/M/yyyy")>=0?d.selectedIndex=3:i.cellsFormat.indexOf("yyyy-MM-dd")>=0?d.selectedIndex=4:i.cellsFormat.indexOf("MMMM, dd, yyyy")>=0&&(d.selectedIndex=5):d.selectedIndex=0;break;case"timeFormat":i&&i.cellsFormat&&i.cellsFormat.indexOf("HH")>=0&&-1===i.cellsFormat.indexOf("T")?d.selectedIndex=1:d.selectedIndex=0;break;case"allowMultipleCollaborators":{let e=!1;i&&i.editor&&i.editor.singleSelect&&(e=!1);const t=r.querySelector(".smart-input");i&&e?(t.value=!0,t.setAttribute("checked","")):(t.value=!1,t.removeAttribute("checked"));break}case"allowThousandsSeparator":{const e=r.querySelector(".smart-input");i&&i.editor&&"numberInput"===i.editor.template&&"progress"!==i.template&&"rating"!==i.template?(e.value=!0,e.setAttribute("checked",""),i.editor.numberFormat&&("decimal"!==i.editor.numberFormat.style||i.editor.numberFormat.notation||i.editor.numberFormat.useGrouping||(e.value=!1,e.removeAttribute("checked")))):(e.value=!0,e.setAttribute("checked",""));break}case"numberFormat":if(i&&"numberInput"===i.editor.template&&i.editor.numberFormat)if("decimal"===i.editor.numberFormat.style&&0===i.editor.numberFormat.maximumFractionDigits)d.selectedIndex=0;else if("decimal"===i.editor.numberFormat.style&&2===i.editor.numberFormat.minimumFractionDigits)d.selectedIndex=1;else if("percent"===i.editor.numberFormat.style&&2===i.editor.numberFormat.minimumFractionDigits)d.selectedIndex=2;else if("percent"===i.editor.numberFormat.style&&0===i.editor.numberFormat.maximumFractionDigits)d.selectedIndex=3;else if("decimal"===i.editor.numberFormat.style&&"scientific"===i.editor.numberFormat.notation)d.selectedIndex=4;else if("decimal"===i.editor.numberFormat.style&&"engineering"===i.editor.numberFormat.notation)d.selectedIndex=5;else if("currency"===i.editor.numberFormat.style&&"accounting"===i.editor.numberFormat.currencySign)d.selectedIndex=6;else if("unit"===i.editor.numberFormat.style){d.selectedIndex=7;const e=i.editor.numberFormat.unit,t=a.unit.querySelector("smart-input");t.dataSource.forEach(((a,l)=>{if(a.value===e)return t.selectedIndex=l,!0}))}else"currency"===i.editor.numberFormat.style&&0===i.editor.numberFormat.maximumFractionDigits&&0===i.editor.numberFormat.minimumFractionDigits?d.selectedIndex=9:"currency"===i.editor.numberFormat.style&&(d.selectedIndex=8);else d.selectedIndex=0;break;case"currency":if(i&&"numberInput"===i.editor.template&&i.editor.numberFormat){if("currency"===i.editor.numberFormat.style){const e=l._getCurrencies().findIndex((e=>e.value===i.editor.numberFormat.currency));e>=0&&(d.selectedIndex=e)}}else d.selectedIndex=0;break;case"allowCheckItems":{const e=r.querySelector(".smart-input");i?i.editor&&!i.editor.pills?(e.value=!0,e.setAttribute("checked","")):!1===i[o]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}case"allowColorItems":{const e=r.querySelector(".smart-input");i?i.editor&&i.editor.colorItems?(e.value=!0,e.setAttribute("checked","")):!1===i[o]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}case"setDefaultValue":{const e=r.querySelector(".smart-input");i?(e.value=!1,e.removeAttribute("checked"),i&&i.defaultValue&&(e.value=!0,e.setAttribute("checked",""))):(e.value=!1,e.removeAttribute("checked"));break}case"defaultString":{const e=r.querySelector("smart-input");i&&void 0!==i.defaultValue&&null!==i.defaultValue?e.value=i.defaultValue:e.value="";break}case"defaultNumber":{const e=r.querySelector("smart-number-input");i&&void 0!==i.defaultValue&&null!==i.defaultValue?e.value=i.defaultValue:e.value=0;break}case"deadline":{const e=r.querySelector(".smart-input");e.selectedIndex=0,e.onchange=()=>{n()},i&&i.editor&&(e.selectedIndex=0,i.editor.onValidate&&"dueDate"!==i.template&&(e.selectedIndex=2),"dueDate"===i.template&&(e.selectedIndex=1)),n();break}case"deadlineStatus":{const t=r.querySelector(".smart-input"),a=[];for(let e=0;e<l.columns.length;e++){const t=l.columns[e];t&&t.editor&&t.editor.dataSource&&t.editor.singleSelect&&a.push({label:t.label,value:t.dataField})}t.dataSource=a,e.editColumn&&(t.selectedValue="",e.editColumn&&e.editColumn.editor.boundDataField&&(t.selectedValue=e.editColumn.editor.boundDataField)),a.length||r.parentElement.classList.add("smart-hidden"),n();break}case"deadlineDueDate":{const t=r.querySelector(".smart-input"),a=[];for(let e=0;e<l.columns.length;e++){const t=l.columns[e];t&&"dueDate"===t.template&&a.push({label:t.label,value:t.dataField})}t.dataSource=a,e.editColumn&&(t.selectedValue="",e.editColumn&&e.editColumn.editor.boundDataField&&(t.selectedValue=e.editColumn.editor.boundDataField)),a.length||r.parentElement.classList.add("smart-hidden"),n();break}case"allowResize":case"allowSort":case"allowEdit":case"allowFilter":case"required":{const e=r.querySelector(".smart-input"),a=t.find((e=>{if(e.bind===o)return e}));i?i[o]?(e.value=!0,e.setAttribute("checked","")):!1===i[o]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,a&&void 0!==a.value&&(e.value=a.value),e.value&&e.setAttribute("checked",""));break}}if(!i||"options"!==o&&"users"!==o){const e=r.querySelector("smart-sortable");if(e&&e._init)if("users"===o){let t=[];for(let e=0;e<l.users.length;e++)t.push({color:l.users[e].color,label:l.users[e].name,id:l.users[e].id,value:l.users[e].id,image:l.users[e].image});e._init(t)}else e._init()}else{const e=r.querySelector("smart-sortable");if(e&&e._init)if(i.editor.singleSelect){const t=i.editor.dataSource.filter((e=>""!==e));e._init(t)}else if("multiComboInput"===i.editor.template)if("users"===o){let t=[];for(let e=0;e<l.users.length;e++)t.push({color:l.users[e].color,label:l.users[e].name,id:l.users[e].id,value:l.users[e].id,image:l.users[e].image});e._init(t)}else e._init(JSON.parse(JSON.stringify(i.editor.dataSource)))}if(i&&"type"===o?(d.dataSource=l._getTypesList(),"number"===i.dataType||"int"===i.dataType?d.dataSource.length>3&&(d.selectedIndex=3):"date"===i.dataType?d.dataSource.length>3&&(d.selectedIndex=7):"bool"!==i.dataType&&"boolean"!==i.dataType||d.dataSource.length>3&&(d.selectedIndex=6),i.editor&&i.editor.template&&d.dataSource.forEach(((e,t)=>{switch(e.value){case"string":"input"===i.editor.template&&(d.selectedIndex=t);break;case"number":"numberInput"===i.editor.template&&"progress"!==i.template&&"rating"!==i.template&&(d.selectedIndex=t);break;case"select":"multiComboInput"===i.editor.template&&i.editor.singleSelect&&"tags"===i.template&&(d.selectedIndex=t);break;case"multiSelect":"multiComboInput"!==i.editor.template||i.editor.singleSelect||"tags"!==i.template||(d.selectedIndex=t);break;case"multiText":"textarea"===i.editor.template&&(d.selectedIndex=t);break;case"date":"dateInput"!==i.editor.template&&"dateTimePicker"!==i.editor.template||(d.selectedIndex=t);break;case"duration":"dateRangeInput"===i.editor.template&&(d.selectedIndex=t);break;case"checkBox":"checkBox"===i.editor.template&&(d.selectedIndex=t);break;case"slider":"slider"===i.editor.template&&(d.selectedIndex=t);break;case"image":"image"===i.editor.template&&(d.selectedIndex=t);break;case"attachment":"attachment"===i.editor.template&&(d.selectedIndex=t);break;case"updatedTime":"updatedTime"===i.template&&(d.selectedIndex=t);break;case"createdTime":"createdTime"===i.template&&(d.selectedIndex=t);break;case"createdBy":"createdBy"===i.template&&(d.selectedIndex=t);break;case"updatedBy":"updatedBy"===i.template&&(d.selectedIndex=t);break;case"collaborator":("collaborator"===i.template&&i.editor&&i.editor.collaborator||"tags"===i.template&&i.editor&&i.editor.collaborator)&&(d.selectedIndex=t);break;case"autoNumber":"autoNumber"===i.template&&(d.selectedIndex=t);break;case"phone":"phone"===i.template&&(d.selectedIndex=t);break;case"password":"password"===i.template&&(d.selectedIndex=t);break;case"url":"url"===i.template&&(d.selectedIndex=t);break;case"email":"email"===i.template&&(d.selectedIndex=t);break;case"dueDate":"dueDate"===i.template&&(d.selectedIndex=t);break;case"rating":"rating"===i.template&&(d.selectedIndex=t);break;case"progress":"progress"===i.template&&(d.selectedIndex=t)}}))):"type"===o&&(d.selectedIndex=0,d.dropDownOpenPosition="auto",d.dataSource=l._getTypesList()),"cellsAlign"===o&&i&&("center"===i.cellsAlign||"middle"===i.cellsAlign?d.selectedIndex=2:"right"===i.cellsAlign&&(d.selectedIndex=1)),!s)continue;if("dataField"!==o&&"type"!==o&&"deadline"!==o&&"timeFormat"!==o&&"dateFormat"!==o&&"deadlineStatus"!==o&&"deadlineDueDate"!==o&&"numberFormat"!==o&&"currency"!==o&&"unit"!==o&&"cellsAlign"!==o&&d&&(d.selectedIndex=0),"name"===o){if(i){const e=i.label;d.value=l._unescapeString(e)}else d.value="";d.placeholder=t.find((e=>{if(e.bind===o)return e})).placeholder}"description"===o&&(d.value=i?l._unescapeString(i.description):"",d.placeholder=t.find((e=>{if(e.bind===o)return e})).placeholder);const c=(e,t)=>{i&&i.validationRules.forEach((a=>"minDate"===a.type&&"minDateTime"===e||"maxDate"===a.type&&"maxDateTime"===e||"min"===a.type&&"minValue"===e||"max"===a.type&&"maxValue"===e||a.type===e?(t.value=a.value,!0):void 0))};if("minValue"===o?(s.value=-9999999,c(o,s)):"maxValue"===o?(s.value=9999999,c(o,s)):"minLength"===o?(s.value=0,c(o,s)):"maxLength"===o&&(s.value=500,c(o,s)),"minDateTime"===o){const e=r.querySelector("smart-date-input");e.value=new Date(1900,0,1),c(o,e)}else if("maxDateTime"===o){const e=r.querySelector("smart-date-input");e.value=new Date(2100,0,1),c(o,e)}}}_createColumnBooleanEditor(e,t,a,l,i){e.setAttribute("template","checkBox"),e.setAttribute("editor","");const n=document.createElement("div");return n.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-check-box-cell-editor"),n.setAttribute("checked",""),n.value=!0,t.width&&(a.style.width=t.width,a.style.float="left"),!1===t.value&&(n.value=!1,n.removeAttribute("checked")),e.appendChild(n),e.getValue=function(){return n.value},e.check=function(){n.setAttribute("checked",""),n.value=!0,e.onchange&&e.onchange(n.value)},e.uncheck=function(){n.removeAttribute("checked"),n.value=!1,e.onchange&&e.onchange(n.value)},e.toggle=function(){!0!==n.value&&!1!==n.value&&null!==n.value&&(n.value=!1),null===n.value?n.value=!1:n.value=!n.value,!1===n.value?n.removeAttribute("checked"):n.setAttribute("checked",n.value?"":"indeterminate"),e.onchange&&e.onchange(n.value)},e.onclick=i.onclick=()=>{e.toggle()},l.appendChild(a),a.classList.add("smart-grid-dialog-boolean-field"),a.appendChild(e),a.appendChild(i),e}_getColumnTemplateByType(e){switch(e){case"boolean":case"bool":return"checkBox";case"image":return"image";case"attachment":return"attachment";case"createdBy":case"updatedBy":return e;case"collaborator":return"collaborator";case"select":case"multiSelect":return"tags";case"url":return"url";case"email":return"email";case"autoNumber":return"autoNumber";case"password":return"password";case"createdTime":return"createdTime";case"updatedTime":return"updatedTime";case"dueDate":return"dueDate";case"duration":return"duration";default:return""}}_confirmAddColumnDialog(e){const t=this,a=e.querySelectorAll(".smart-grid-dialog-editor"),l=[];let i,n,o={};e===t._dialogAddStackColumn&&(o.type="select");for(let e=0;e<a.length;e++){const l=a[e],i=l.querySelector(".smart-input"),n=l.getAttribute("bind"),r=l.parentElement;if("kanban"!==n)if("name"!==n&&"description"!==n)if("minLength"!==n&&"maxLength"!==n&&"minValue"!==n&&"maxValue"!==n&&"minDateTime"!==n&&"maxDateTime"!==n)if("options"!==n&&"users"!==n){if("allowEdit"===n&&r.classList.contains("smart-hidden"))i.value=!1;else if("required"===n&&r.classList.contains("smart-hidden"))i.value=!1;else if("dateFormatSeparator"===n){const e=l.querySelectorAll(".smart-grid-dialog-boolean-field");for(let t=0;t<e.length;t++)if(e[t].querySelector("[checked]")){switch(t){case 0:o.dateFormatSeparatorType="/";break;case 1:o.dateFormatSeparatorType="-";break;case 2:o.dateFormatSeparatorType="."}break}}i&&(i.getSelectedItem?o[n]=i.getSelectedItem().value:o[n]=i.value)}else{const e=[],a=l.querySelectorAll(".smart-grid-add-column-dialog-color-item .edit-column-input"),i=l.querySelectorAll(".smart-grid-add-column-dialog-color-item smart-color-input");for(let t=0;t<a.length;t++){const l=a[t],n={label:l.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/\\/g,""),value:l.getAttribute("data-item-value").replace(/\\/g,""),id:parseInt(l.getAttribute("data-id")),color:i[t].value};n.color=i[t].value,e.push(n)}if("users"===n&&"collaborator"===o.type){t.users||(t.users=[]);for(let a=0;a<e.length;a++){const l=e[a],i=t.users.find((e=>e.id===l.id));i&&(i.name=l.label,i.color=l.color)}}o[n]=e;const r=l.querySelector(".smart-default-item");o["default_"+n]=r.selectedValues?r.selectedValues[0]:null}else o[n]=i.getValue();else o[n]=i.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;");else{const e=l.querySelectorAll(".smart-grid-dialog-boolean-field");for(let t=0;t<e.length;t++){const a=e[t];if(a.querySelector("[checked]")){o.kanban=a.name;break}}}}e.data=o;let r={},s={},d="";if(i=o.minDateTime,n=o.maxDateTime,"date"===o.type||"dueDate"===o.type||"startDate"===o.type){r={template:"dateInput",min:i,max:n};let e=!1;o.deadlineStatus&&(r.boundDataField=o.deadlineStatus),"-"!==o.dateFormat&&(d=o.dateFormat,o.allowCustomDateSeparator&&(d.indexOf("/")>=0?d=d.replaceAll("/",o.dateFormatSeparatorType):d.indexOf("-")>=0?d=d.replaceAll("-",o.dateFormatSeparatorType):d.indexOf(".")>=0&&(d=d.replaceAll(".",o.dateFormatSeparatorType))),o.dateFormat.indexOf("T")>=0&&(r.template="dateTimePicker",r.dropDownDisplayMode="auto",r.formatString=d),e=!0),r.autoOpen=!0,o.allowTimeFormat&&"-"!==o.timeFormat&&(e&&(d+=" "),d+=o.timeFormat,r.template="dateTimePicker",r.dropDownDisplayMode="auto",r.formatString=d),o.cellsFormat=d,l.push({type:"minDate",value:i}),l.push({type:"maxDate",value:n})}else if("time"===o.type)r={template:"timeInput",hour12:!0},o.timeFormat.indexOf("HH")>=0&&(r.hour12=!1),r.autoOpen=!0,d=o.timeFormat,o.cellsFormat=d;else if("duration"===o.type)r={template:"dateRangeInput"},d="MM/dd/yyyy hh:mm",o.cellsFormat=d;else if("number"===o.type||"slider"===o.type){i=parseInt(o.minValue),n=parseInt(o.maxValue),o.numberFormat=JSON.parse(JSON.stringify(o.numberFormat)),"unit"===o.numberFormat.style&&(o.numberFormat.unit=o.unit);let e=null,a=null;"currency"===o.numberFormat.style&&(o.numberFormat.currency=o.currency,o.numberFormat.locale=t._getLocaleByCurrency(o.currency)),"decimal"!==o.numberFormat.style||o.numberFormat.notation||(o.numberFormat.useGrouping=o.allowThousandsSeparator),r={template:"number"===o.type?"numberInput":"slider",min:i,max:n,numberFormat:o.numberFormat},s={Intl:{NumberFormat:o.numberFormat}},a&&(s=a),d="d",e&&(d=e),l.push({type:"min",value:i}),l.push({type:"max",value:n})}else if("rating"===o.type)r={template:"rating"};else if("boolean"===o.type)r={template:"checkBox"};else if("image"===o.type)r={template:"image"};else if("attachment"===o.type)r={template:"attachment"};else if("select"===o.type||"multiSelect"===o.type||"tags"===o.type){let a=o.options,l=!1;if("select"===o.type)if(e.editColumn&&!e.editColumn.editor.allowEmptyItem){a=o.options;const i=[];for(let e=0;e<o.options.length;e++)if(""===o.options[e].label)o.options[e].value="";else if(""===o.options[e].value){const t=Smart.Utilities.Core.toCamelCase(o.options[e].label.replaceAll(" ","-"));if(i[t])continue;o.options[e].value=t,i.push(t)}else if(!isNaN(parseInt(o.options[e].value))){const t=o.options[e].label.replaceAll(" ","").trim().toLowerCase();if(i[t])continue;o.options[e].value=t,i.push(t)}if(e.editColumn._dataField&&"taskStatus"===e.editColumn._dataField||e===t._dialogAddStackColumn)for(let e=0;e<o.options.length;e++){const t=o.options[e];isNaN(parseInt(t.value))||(t.value=t.label.replaceAll(" ",""))}a=o.options;let n=!1;for(let e=0;e<o.options.length;e++)if(""===o.options[e].label){n=!0,l=!0,o.options[e].value="";break}a=n?o.options:[{color:"#F47A54",value:"",label:""}].concat(o.options)}else{const e=[];let t=!1;for(let a=0;a<o.options.length;a++)if(""===o.options[a].label)t=!0,l=!0,o.options[a].value="";else if(""===o.options[a].value){const t=Smart.Utilities.Core.toCamelCase(o.options[a].label.replaceAll(" ","-"));if(e[t])continue;o.options[a].value=t,e.push(t)}else if(!isNaN(parseInt(o.options[a].value))){const t=o.options[a].label.replaceAll(" ","").trim().toLowerCase();if(e[t])continue;o.options[a].value=t,e.push(t)}a=t?o.options:[{color:"#F4511E",value:"",label:""}].concat(o.options)}else if("multiSelect"===o.type){const e=[];for(let t=0;t<o.options.length;t++)if(""===o.options[t].label)o.options[t].value="";else if(""===o.options[t].value){const a=Smart.Utilities.Core.toCamelCase(o.options[t].label.replaceAll(" ","-"));if(e[a])continue;o.options[t].value=a,e.push(a)}else if(!isNaN(parseInt(o.options[t].value))){const a=o.options[t].label.replaceAll(" ","").trim().toLowerCase();if(e[a])continue;o.options[t].value=a,e.push(a)}a=o.options}a.length&&""===a[0]&&!l&&o.required&&(a=a.splice(1)),r={template:"multiComboInput",readonly:!0,dropDownButtonPosition:"right",colorItems:o.allowColorItems,autoOpen:!0,pills:!0,singleSelect:"select"===o.type,dataSource:a}}else if("collaborator"===o.type){let e=o.users;o.allowMultipleCollaborators||e&&e.length&&""!==e[0].value&&(e=[{label:"",value:"",color:"#F47A54"}].concat(o.users));for(let a=0;a<t.users.length;a++)e.forEach((e=>{e.value!==t.users[a].id&&e.value!==""+t.users[a].id||(e.image=t.users[a].image,e.id=t.users[a].id)}));r={template:"multiComboInput",readonly:!0,collaborator:!0,colorItems:o.allowColorItems,dropDownButtonPosition:"right",autoOpen:!0,pills:!0,singleSelect:!o.allowMultipleCollaborators,dataSource:e}}else"multiText"===o.type?(i=o.minLength,n=o.maxLength,r={template:"textarea",min:i,max:n,required:o.required},l.push({type:"minLength",value:i}),l.push({type:"maxLength",value:n})):"password"===o.type?(i=o.minLength,n=o.maxLength,r={template:"password",min:i,max:n,required:o.required},l.push({type:"minLength",value:i}),l.push({type:"maxLength",value:n})):"phone"===o.type?r={template:"phone",required:o.required}:(i=o.minLength,n=o.maxLength,r={template:"input",min:i,max:n,required:o.required},l.push({type:"minLength",value:i}),l.push({type:"maxLength",value:n}));let c="string";switch(o.type){case"boolean":case"bool":c="boolean";break;case"createdTime":case"updatedTime":case"duration":case"date":c="date";break;case"time":c="time";break;case"autoNumber":case"slider":case"rating":case"number":c="number"}const u=e=>{if(o.setDefaultValue)switch(o.type){case"string":case"multiText":case"description":case"name":e.defaultValue=o.defaultString;break;case"number":case"slider":e.defaultValue=o.defaultNumber;break;case"date":case"dueDate":case"startDate":e.defaultValue="current"===o.defaultDate?"today":o.defaultDateValue;break;case"collaborator":void 0!==o.default_users?e.defaultValue=o.default_users:e.defaultValue=null;break;case"select":case"multiSelect":case"status":case"priority":o.default_options?e.defaultValue=o.default_options:e.defaultValue=null}else e.defaultValue=null};if(e.editColumn){const a=e.editColumn;a.canNotify=!1,a.label=o.name,void 0!==o.description&&(a.description=o.description),a.showDescriptionButton=!0,void 0!==o.allowResize&&(a.allowResize=o.allowResize),void 0!==o.allowSort&&(a.allowSort=o.allowSort),void 0!==o.allowFilter&&(a.allowFilter=o.allowFilter),void 0!==o.allowEdit&&(a.allowEdit=o.allowEdit),void 0!==o.cellsAlign&&(a.align=a.cellsAlign=o.cellsAlign),void 0!==o.cellsFormat&&(a.cellsFormat=d);const i=a._editorId?a._editorId:"",n=r.template+"_"+a.dataField+i;t._cellEditors[n]&&delete t._cellEditors[n];let m=!0;"list"!==a.template&&"dropDownList"!==a.template||(m=!1),"autoNumber"!==a.template&&"createdBy"!==a.template&&"updatedBy"!==a.template&&"createdTime"!==a.template&&"progress"!==a.template&&"updatedTime"!==a.template&&"checklist"!==a.template&&"color"!==a.template||(m=!1),a.editor&&a.editor.template.indexOf("custom")>=0&&(m=!1),a.editor&&a.editor.disabledDialogOptions&&(m=!1),u(a),m&&(a.editor=JSON.parse(JSON.stringify(r)),a.template=t._getColumnTemplateByType(o.type),a._cellsCachedValues=[]),"date"===o.type&&("dueDate"===o.deadline?(r=t._getKanbanTaskField("dueDate").editor,o.deadlineStatus&&(r.boundDataField=o.deadlineStatus),a.template="dueDate"):"startDate"===o.deadline?(r=t._getKanbanTaskField("startDate").editor,o.deadlineDueDate&&(r.boundDataField=o.deadlineDueDate),a.template="startDate"):(a.template="",r.template="dateInput",r.onValidate=null)),a.formatSettings=s,o.type!==e.columnType&&e.columnType&&(a.dataType=c),a.icon=t._getIconByType(o.type),a._isDirty=!0,o.required&&l.push({type:"required"}),a.validationRules=l,a._state&&["label","description","showDescriptionButton","dataType","editor","formatSettings","template","summary","validationRules","allowResize","allowSort","allowFilter","allowEdit","align","cellsAlign","cellsFormat"].forEach((e=>{a._state[e]=a[e]})),a.canNotify=!0,t.$.fireEvent("closeColumnDialog",{dataField:a.dataField}),t.onColumnUpdated&&t.onColumnUpdated(t.columns.indexOf(a),a),t._onColumnUpdated&&t._onColumnUpdated(a,o),t._recycle(!0),a.refresh(),a._isDirty=!1}else{let e=[];"number"===c&&(e=["sum"]);const a=t._getColumnLabel(o),i=new Smart.Grid.Column({label:a,description:o.description,dataField:o.dataField||"dataField"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),allowResize:o.allowResize,allowSort:o.allowSort,allowFilter:o.allowFilter,allowEdit:o.allowEdit,showDescriptionButton:!0,dataType:c,editor:r,summary:e,template:t._getColumnTemplateByType(o.type),formatSettings:s,cellsAlign:o.cellsAlign,align:o.cellsAlign,cellsFormat:d,visibleIndex:t.columns.length-1,grid:t});if("autoNumber"===i.template&&(i.autoGenerated=!0,e=[]),u(i),o.required&&(l.push({type:"required"}),i.validationRules=l),"date"===o.type&&("dueDate"===o.deadline?o.type="dueDate":"startDate"===o.deadline&&(o.type="startDate")),t._getKanbanFields().indexOf(o.type)>=0){const e=t._getKanbanTaskField(o.type);switch(u(e),"startDate"===o.type&&o.deadlineDueDate&&(e.editor.boundDataField=o.deadlineDueDate),"dueDate"===o.type&&o.deadlineStatus&&(e.editor.boundDataField=o.deadlineStatus),delete e._state,o.description&&(e.description=o.description),o.name&&(e.label=o.name),e.allowFilter=o.allowFilter,e.allowResize=o.allowResize,e.allowSort=o.allowSort,o.type){case"priority":case"status":case"tags":e.editor.dataSource=JSON.parse(JSON.stringify(o.options))}let a=t.columnByDataField[e.dataField];if("status"===o.type||"name"===o.type||"description"===o.type)for(let e=0;e<t.columns.length;e++){const l=t.columns[e];if(l._dataField&&!t.columnByDataField[l._dataField]&&(t.columnByDataField[l._dataField]=l),l.statusColumn||"taskStatus"===l._dataField){a=l;break}}a&&!1===a._visible?(a.visible=!0,delete a._visible):(a&&(e.dataField=e.displayField="dataField"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),"object"==typeof e.editor&&e.editor.dataSource&&(e.editor.dataSource=JSON.parse(JSON.stringify(e.editor.dataSource))),o.name||(e.label=e.label+" "+t.localize("copy"))),t.columns.push(e))}else t.columns.push(i);t._refreshHeaderBar(),t.$.fireEvent("closeColumnDialog",{dataField:i.dataField})}}_getColumnLabel(e){const t=this;let a=e.name;if(!a){let a="";switch(e.type){case"string":a=t.localize("dialogAddColumnTypeText");break;case"multiText":a=t.localize("dialogAddColumnTypeMultilineText");break;case"image":a=t.localize("dialogAddColumnTypeImage");break;case"attachment":a=t.localize("dialogAddColumnTypeAttachment");break;case"number":a=t.localize("dialogAddColumnTypeNumber");break;case"select":a=t.localize("dialogAddColumnTypeSelect");break;case"multiSelect":a=t.localize("dialogAddColumnTypeMultipleSelect");break;case"boolean":a=t.localize("dialogAddColumnTypeCheckBox");break;case"date":a=t.localize("dialogAddColumnTypeDate");break;case"time":a=t.localize("dialogAddColumnTypeTime");break;case"duration":a=t.localize("dialogAddColumnTypeDuration");break;case"createdTime":a=t.localize("dialogAddColumnTypeCreatedTime");break;case"updatedTime":a=t.localize("dialogAddColumnTypeLastUpdatedTime");break;case"createdBy":a=t.localize("dialogAddColumnTypeCreatedBy");break;case"updatedBy":a=t.localize("dialogAddColumnTypeLastUpdatedBy");break;case"collaborator":a=t.localize("dialogAddColumnTypeCollaborator");break;case"slider":a=t.localize("dialogAddColumnTypeSlider");break;case"autoNumber":a=t.localize("dialogAddColumnTypeAutoNumber");break;case"url":a=t.localize("dialogAddColumnTypeURL");break;case"email":a=t.localize("dialogAddColumnTypeEmail");break;case"phone":a=t.localize("dialogAddColumnTypePhone");break;case"password":a=t.localize("dialogAddColumnTypePassword");break;case"rating":a=t.localize("dialogAddColumnTypeRating")}let l=1;for(let e=0;e<t.columns.length;e++)t.columns[e].label.indexOf(a)>=0&&l++;return 1===l?a:a+" "+l}return a}_openAddColumnDialog(e,t,a){const l=this,i=l._dialogAddColumn||l._createDialog(l.editing.addColumnDialog),n=e?l.localize("dialogEditColumn",{value:e.label}):l.localize("dialogAddColumn"),o=i.querySelector(".smart-footer").querySelector(".smart-stack-layout");i.classList.add("smart-grid-dialog-add-column"),i.type=e?"customize":"add",i.editColumn=e||null,e&&e.element?e.element.setAttribute("focus",""):l._addNewColumn&&l._addNewColumn.element.setAttribute("focus",""),o.classList.remove("right"),o.classList.add("center"),l._cellEditors||(l._cellEditors=[]);const r=l._getAddColumnDialogTemplate();if(i.header.innerHTML=n,i.header.parentElement.classList.add("smart-hidden"),i.callback=a,!0===t&&(i.header.parentElement.classList.remove("smart-hidden"),"kanban"===l.view?(i.header.innerHTML=l.localize("dialogAddColumnStatus"),i.header.parentElement.querySelector(".smart-close-button").classList.add("smart-hidden"),i.classList.add("view")):i.classList.remove("kanban")),i.stackLabel&&i.stackLabel.classList.add("smart-hidden"),"kanban"===l.view?i.btnCancel.classList.add("smart-hidden"):i.btnCancel.classList.remove("smart-hidden"),l.cancelEdit(),!l._dialogAddColumn){i.modal=!0,i.btnConfirm.innerHTML=l.localize("dialogEditButtonConfirm"),i.btnCancel.innerHTML=l.localize("dialogEditButtonCancel"),i.onOpen=function(){const e=l._dialogAddColumn,t=l._getAddColumnDialogTemplate(),a=l._addColumnDialogEditors;if(delete e.columnType,l._addColumnDialogInitEditors(e,t,a),l._addColumnDialogShowHideEditors(e),e.editColumn){const t=e.querySelector('[bind="type"]'),a=t?t.querySelector("smart-input"):null,l=t?a.getSelectedItem().value:"kanban";e.columnType=l}else delete e.columnType;l._filterColumnTypes(),l.$.fireEvent("openColumnDialog",{dataField:e.editColumn?e.editColumn.dataField:null});const i=l.offset(l.$.columnHeader),n=l.$.columnHeader.offsetHeight,o=l.offset(l);if(e.style.maxHeight="",e.style.minHeight="",i.top+n+e.offsetHeight>window.innerHeight-o.top){const t=n+i.top+e.offsetHeight-window.innerHeight+o.top;e.style.maxHeight=Math.max(250,e.offsetHeight-t)+"px",e.style.minHeight="250px"}else e.style.maxHeight="",e.style.minHeight=""},i.onClose=function(){i.editColumn&&i.editColumn.element&&i.editColumn.element.removeAttribute("focus"),l._addNewColumn&&l._addNewColumn.element.removeAttribute("focus"),i.classList.remove("view"),i.callback&&i.callback(i.result)},i.btnCancel.onclick=function(){i.result=!1,i.close()},i.btnClose.onclick=function(){i.result=!1,i.close()},i.btnConfirm.onclick=function(){l._confirmAddColumnDialog(i),i.result=!0,i.close()},i.onkeydown=function(e){"Escape"===e.key&&"kanban"!==l.view&&(i.result=!1,i.close())},l._dialogAddColumn=i;const e=document.createElement("div");e.classList.add("smart-content-layout-container"),i.content.appendChild(e),l._addColumnDialogEditors=[];const t=l._addColumnDialogEditors;l._initAddColumnDialogEditors(t,r,i,e)}const s=()=>{const t=parseInt(i.style.width),a=l.offset(l);if(window.screen.availWidth<400)return i.open("left","top"),i.style.width=l.offsetWidth+"px",void(i.style.height=l.offsetHeight+"px");{const e=l.editing.addColumnDialog;i.style.width="auto"===e.width?e.width:e.width+"px",i.style.height="auto"===e.height?e.height:e.height+"px"}if(e){const n=e.element;if(n){const e=l.offset(n),o=e.left-a.left,r=a.left,s=Math.max(r,o);if(s+t+n.offsetWidth>a.left+l.offsetWidth){const l=s-t+n.offsetWidth;l<0?i.open("center",e.top+n.offsetHeight-a.top):i.open(Math.max(r,l),e.top+n.offsetHeight-a.top)}else i.open(s,e.top+n.offsetHeight-a.top)}else i.classList.add("center"),i.open("center","center")}else if(l._addNewColumn){let e=l._addNewColumn.element,n=l.offset(e),o=n.left-a.left-t+e.offsetWidth,r=a.left,s=Math.max(r,o);l.editing.addNewColumn._addButton&&l.editing.addNewColumn._addButton.classList.contains("show")&&(e=l.editing.addNewColumn._addButton,n=l.offset(l.editing.addNewColumn._addButton),o=n.left-a.left-t+e.offsetWidth,r=a.left,s=Math.max(r,o)),i.open(s,n.top+e.offsetHeight-a.top)}else i.open("center","center"),i.classList.add("center")};s(),i.refresh=()=>{s()}}_filterColumnTypes(){const e=this,t=e._dialogAddColumn;if(!t)return;const a=e._dialogAddColumn.querySelector('[bind="type"]').querySelector("smart-input");if(t.columnType){const l=e._getTypesList().find((e=>{if(e.value===t.columnType)return e}));if(l)if("string"===t.columnType||"multiText"===t.columnType)a.dataSource=e._getTypesList().filter((e=>!(["createdTime","updatedTime","createdBy","updatedBy","autoNumber","image","color","checklist","progress","collaborator","attachment"].indexOf(e.value)>=0)));else{const t=[{value:"string",prefix:'<span class="smart-grid-icon visible smart-icon-font"></span>',label:e.localize("dialogAddColumnTypeText")},{value:"multiText",prefix:'<span class="smart-grid-icon visible smart-icon-fontsize"></span>',label:e.localize("dialogAddColumnTypeMultilineText")}].concat(l);a.dataSource=t}else a.dataSource=e._getTypesList()}else t.editColumn||(a.dataSource=e._getTypesList(),a.selectedIndex=0)}_getIconByType(e){let t="smart-icon-font";switch(e){case"multiText":t="smart-icon-fontsize";break;case"image":t="smart-icon-image";break;case"attachment":t="smart-icon-docs";break;case"number":case"progress":t="smart-icon-number";break;case"priority":case"status":case"select":t="smart-icon-sort-down";break;case"multiSelect":t="smart-icon-list-unordered";break;case"boolean":t="smart-icon-check-squared";break;case"date":case"startDate":case"duration":case"dueDate":t="smart-icon-calendar";break;case"time":case"createdTime":case"updatedTime":t="smart-icon-clock";break;case"createdBy":case"updatedBy":case"collaborator":t="smart-icon-user";break;case"slider":t="smart-icon-number";break;case"autoNumber":case"checklist":t="smart-icon-list-ordered";break;case"url":t="smart-icon-link";break;case"email":t="smart-icon-mail";break;case"password":t="smart-icon-lock";break;case"phone":t="smart-icon-phone";break;case"name":t="smart-icon-font";break;case"description":t="smart-icon-fontsize";break;case"tags":t="smart-icon-list-ordered";break;case"color":t="smart-icon-color-background";break;case"assigned":t="smart-icon-user";break;case"rating":t="smart-icon-star"}return t}_initAddColumnDialogEditors(e,t,a,l){const i=this;for(let n=0;n<t.length;n++){const o=t[n],r=document.createElement("div"),s=document.createElement("label");s.innerHTML=o.label;const d=document.createElement("div");if(d.classList.add("smart-grid-dialog-editor","add-column"),d.innerHTML="",d.setAttribute("filter",o.filter),d.setAttribute("bind",o.bind),r.setAttribute("field-name",o.bind),r.setAttribute("field-filter",o.filter),e[o.bind]=d,"type"===o.bind&&d.addEventListener("change",(()=>{i._addColumnDialogShowHideEditors(a),a.editColumn&&i._filterColumnTypes();const t=i._dialogAddColumn.querySelector('[bind="type"]'),l=t.querySelector("smart-input"),n=l.getSelectedItem().value,o=i._getIconByType(n);if(e.type.icon=o,e.name.querySelector("input").setAttribute("data-label",l.value),t.firstElementChild.className="smart-grid-icon show smart-description-button "+o,"select"===n||"multiSelect"===n){const t=e.options.querySelector("smart-sortable");if(t&&t._validate){if(a.editColumn)if(a.editColumn.editor.dataSource)t._init([...a.editColumn.editor.dataSource]);else{const e=[];for(let t=0;t<i.rows.length;t++){const l=i.rows[t].data[a.editColumn.dataField];if(l&&l.indexOf(",")>=0){const t=l.split(",");for(let a=0;a<t.length;a++)-1===e.indexOf(t[a].trim())&&e.push(t[a].trim())}else-1===e.indexOf(l)&&e.push(l)}e.length?t._init(e.map((e=>{let t=Smart.Utilities.Core.toDash(e);return t=t.replaceAll("-"," "),t=t.substring(0,1).toUpperCase()+t.substring(1),{value:e,label:t}}))):t._init()}else t._init();t._validate()}}else if("priority"===n||"status"===n||"tags"===n){const t=e.options.querySelector("smart-sortable"),a=i._getKanbanTaskField(n);t&&t._validate&&(t._init([...a.editor.dataSource]),t._validate())}else a.btnConfirm.disabled=!1})),"boolean"===o.type)i._createColumnBooleanEditor(d,o,r,l,s);else{if("label"===o.type){l.appendChild(r),r.classList.add("smart-grid-dialog-field"),r.appendChild(s);const e=document.createElement("div");e.style.height="10px",r.appendChild(e);continue}{let c=document.createElement("smart-input");if(c.classList.add("underlined","edit-column-input"),c.style.width="100%",c.style.height="30px",o.width&&(r.style.width=o.width,r.style.float="left"),"items"===o.type){const t=document.createElement("smart-button");t.classList.add("primary"),t.innerHTML='<div style="align-items: center; white-space: nowrap; display: flex;"><span class="smart-grid-icon show smart-icon-plus"></span><span>'+i.localize("commandBarAddRow")+"</span></div>";const l=document.createElement("div");l.classList.add("smart-grid-add-column-dialog-color-panel");const n=document.createElement("smart-sortable");n.disableMode="manual",n.dragMode="handle",n.handlePosition="left",n.handleVisibility="visible";const r=()=>{if(a.btnConfirm.disabled=!1,0===l.offsetHeight)return;let e=0;l.querySelectorAll(".edit-column-input").forEach((t=>{""===t.value&&e++,e>1&&(a.btnConfirm.disabled=!0)})),n._updateDefaultInput()},s=(l,s,d,c)=>{const u=document.createElement("div"),m=i._getColorInput(),p=document.createElement("div"),g=document.createElement("smart-input"),b=e.allowColorItems;if(void 0!==d)g.setAttribute("data-id",d),g.setAttribute("data-item-value",d);else{const e=n.querySelectorAll(".smart-sortable-item").length;g.setAttribute("data-id",e),g.setAttribute("data-item-value",e)}return void 0!==c&&g.setAttribute("data-item-value",c),m.disabled=!b.querySelector(".smart-input").value,p.className="smart-grid-icon smart-icon-close show",p.setAttribute("role","button"),p.setAttribute("aria-label","button"),g.classList.add("underlined","edit-column-input"),g.style.width="100%",g.style.height="30px",g.required=!0,(a.editColumn&&"collaborator"===a.editColumn.template||"users"===o.bind)&&(g.disabled=!0),l&&(g.value=i._unescapeString(l)),s&&(m.value=s),g.onkeyup=g.onchange=g.onblur=e=>{r(),"Enter"===e.key&&(g.parentElement.nextElementSibling||(t.click(),r()))},m.onchange=()=>{n._updateDefaultInput()},u.appendChild(m),u.appendChild(g),"users"!==o.bind&&u.appendChild(p),p.onmouseenter=()=>{if(i._dialogAddColumn&&i._dialogAddColumn.editColumn){if(p.title="",!c)return;const e=i._dialogAddColumn.editColumn;for(let t=0;t<i.rows.length;t++)if(i.rows[t].data[e.dataField]===c){p.title=i.localize("dialogAddColumnListItemsError");break}}},p.onclick=()=>{p.title||(u.remove(),n.updateItems(),r())},u.classList.add("smart-sortable-item","smart-grid-add-column-dialog-color-item"),"users"===o.bind&&u.setAttribute("disable-drag",""),u};n._getOptions=e=>{const t=[],a=l.querySelectorAll(".smart-grid-add-column-dialog-color-item .edit-column-input"),n=l.querySelectorAll(".smart-grid-add-column-dialog-color-item smart-color-input");for(let e=0;e<a.length;e++){const l=a[e],i={label:l.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/\\/g,""),value:l.getAttribute("data-item-value").replace(/\\/g,""),id:parseInt(l.getAttribute("data-id")),color:n[e].value};i.color=n[e].value;const o=parseInt(i.value);if(!isNaN(o)){const e=i.label.replaceAll(" ","").trim().toLowerCase();i.value=e}t.push(i)}if("users"===e.bind){i.users||(i.users=[]);for(let e=0;e<t.length;e++){const a=t[e],l=i.users.find((e=>e.id===a.id));l&&(l.name=a.label,l.color=a.color)}}return t},n._updateDefaultInput=e=>{e||(e=n._getOptions(o)),n._defaultInput&&(n._defaultInput.dataSource=e,n._defaultInput.selectedValues=[],!e||e&&!e.length||"kanban"===i.view?(n._defaultInput.classList.add("smart-hidden"),n._defaultOption.classList.add("smart-hidden")):(a.editColumn&&a.editColumn.defaultValue&&(n.selectedValues=[a.editColumn.defaultValue]),n._defaultInput.classList.remove("smart-hidden"),n._defaultOption.classList.remove("smart-hidden")))},n._init=e=>{n.clearContent(),"users"===o.bind?(n.handleVisibility="none",n.handlePosition="none"):(n.handleVisibility="visible",n.handlePosition="left"),e&&(e.forEach(((e,t)=>{const a=void 0!==e.id?e.id:t,l=s(e.label,e.color,a,e.value);n.$.container.appendChild(l)})),n.updateItems()),n._updateDefaultInput(e)},n._validate=r,e.allowColorItems.onchange=t=>{let a=e.allowColorItems.parentElement.nextElementSibling,l=null;for(;a;){if("options"===a.getAttribute("field-name")){if(l=a,l&&l.classList.contains("smart-hidden")){a=a.nextElementSibling;continue}break}if("users"===a.getAttribute("field-name")){if(l=a,l&&l.classList.contains("smart-hidden")){a=a.nextElementSibling;continue}break}a=a.nextElementSibling}l&&l.querySelectorAll("smart-color-input").forEach((e=>{e.disabled=!t}))},l.appendChild(n),"users"!==o.bind&&(l.appendChild(t),t.onclick=()=>{const e=s();n.$.container.appendChild(e),n.updateItems(),e.querySelector(".edit-column-input").focus(),a.btnConfirm.disabled=!0});const u=document.createElement("div");u.innerHTML=i.localize("dialogAddColumnDefault");const m=document.createElement("smart-multi-combo-input");m.singleSelect=!0,m.readonly=!0,m.dropDownButtonPosition="right",m.colorItems=!0,m.autoOpen=!0,m.pills=!0,m.style.setProperty("--smart-surface","--smart-background"),m.style.width="100%",m.classList.add("smart-default-item","underlined");const p=document.createElement("div");p.style.display="flex",p.style.flexDirection="column",p.style.marginTop="5px",p.classList.add("smart-default-item-container"),p.appendChild(u),p.appendChild(m),l.appendChild(p),n._defaultInput=m,n._defaultOption=u,c=l,d.style.height="auto"}else if("number"===o.type)c=document.createElement("smart-number-input"),c.classList.add("underlined"),c.style.width="100%",c.style.height="30px","minValue"===o.bind?(c.value=0,c.min=-9999999,c.max=9999999):"maxValue"===o.bind?(c.value=1e6,c.min=-9999999,c.max=9999999):"minLength"===o.bind?c.value=0:"maxLength"===o.bind&&(c.value=500);else if("datetime"===o.type)c=document.createElement("smart-date-input"),c.classList.add("underlined"),c.style.width="100%",c.style.height="30px","minDateTime"===o.bind?c.value=new Date(1900,0,1):"maxDateTime"===o.bind&&(c.value=new Date(2100,0,1));else if("radio"===o.type){const e=(e,t,a)=>{const l=document.createElement("div"),i=document.createElement("label"),n=document.createElement("div");return i.innerHTML=e,n.classList.add("smart-input"),n.classList.add("smart-grid-cell-editor"),n.classList.add("smart-grid-check-box-cell-editor"),t&&n.setAttribute("checked",""),n.value=void 0!==t&&t,d.appendChild(n),l.onclick=function(){if(n.value=!0,!1===n.value?n.removeAttribute("checked"):n.setAttribute("checked",n.value?"":"indeterminate"),l.onchange&&l.onchange(l),n.value){const e=n.parentElement.parentElement.parentElement;e.querySelectorAll(".smart-grid-cell-editor").forEach((e=>{e.value=!1,e.removeAttribute("checked")})),n.value=!0,n.setAttribute("checked",n.value?"":"indeterminate"),e.value=a}},l.appendChild(n),l.appendChild(i),l.classList.add("smart-grid-dialog-boolean-field"),l.setAttribute("template","checkBox"),l.setAttribute("editor",""),l.label=i,l.value=t,l.name=a,l},t=document.createElement("div");t.classList.add("smart-grid-dialog-radio-field"),d.classList.add("radio-group");for(let a=0;a<o.options.length;a++){const l=o.options[a],i=e(l.label,l.checked,l.value);if(o.columns){const e=100/o.columns;i.style.width=e+"%",i.style.float="left"}t.appendChild(i),l.checked&&(d.value=l.value)}const a=document.createElement("div");a.style.clear="both",t.appendChild(a),c=t}if(o.options){c.readonly=!0;let e=o.options;"type"===o.bind&&(void 0!==i.currentUser&&null!==i.currentUser||(e=e.filter((e=>"updatedBy"!==e.value&&"createdBy"!==e.value))),(void 0===i.users||null===i.users||i.users&&0===i.users.length)&&(e=e.filter((e=>"collaborator"!==e.value)))),c.dataSource=e,c.dropDownButtonPosition="right","dataField"!==o.bind&&(c.selectedIndex=0),o.options.length<15?c.dropDownHeight="auto":c.dropDownHeight=300}if(o.icon){const e=document.createElement("span");e.classList.add("smart-grid-icon",o.icon,"show","smart-description-button"),d.appendChild(e),c.style.width="calc(100% - 25px)"}if(d.appendChild(c),o.info){const e=document.createElement("span");e.classList.add("smart-grid-icon","smart-icon-attention-circled","show","smart-description-button"),e.title=o.info,d.appendChild(e),c.style.width="calc(100% - 25px)"}if(l.appendChild(r),r.classList.add("smart-grid-dialog-field"),r.appendChild(s),r.appendChild(d),o.width&&!t[n+1].width){const e=document.createElement("div");e.style.clear="both",l.appendChild(e)}}}}}_getLocaleByCurrency(e){const t={AED:"ar_AE",AFN:"fa_AF",ALL:"sq",AMD:"hy",ANG:"nl",AOA:"pt_AO",ARS:"es_AR",AUD:"en",AWG:"nl_AW",AZN:"az",BAM:"bs",BBD:"en_BB",BDT:"bn_BD",BGN:"bg",BHD:"ar_BH",BIF:"fr_BI",BMD:"en_BM",BND:"ms_BN",BOB:"es_BO",BRL:"pt_BR",BSD:"en_BS",BTN:"dz",BWP:"en_BW",BYN:"be",BYR:"be",BZD:"en_BZ",CAD:"en_CA",CDF:"fr_CD",CHF:"de_CH",CLP:"es_CL",CNY:"zh_Hans_CN",COP:"es_CO",CRC:"es_CR",CUP:"es_CU",CVE:"pt_CV",CZK:"cs",DJF:"fr_DJ",DKK:"da_DK",DOP:"es_DO",DZD:"ar_DZ",EGP:"ar_EG",ERN:"ti_ER",ETB:"am",EUR:"de",FJD:"en_FJ",FKP:"en_FK",GBP:"en",GEL:"ka",GHS:"en_GH",GIP:"en_GI",GMD:"en_GM",GNF:"fr_GN",GTQ:"es_GT",GYD:"en_GY",HKD:"zh_Hans_HK",HNL:"es_HN",HRK:"hr_HR",HTG:"en",HUF:"hu_HU",IDR:"id",ILS:"he",INR:"en_IN",IQD:"ar_IQ",IRR:"fa_IR",ISK:"is",JMD:"en_JM",JOD:"ar_JO",JPY:"ja",KES:"en_KE",KGS:"ky",KHR:"km",KMF:"ar",KPW:"ko_KP",KRW:"ko_KR",KWD:"ar_KW",KYD:"en_KY",KZT:"kk",LAK:"lo",LBP:"ar_LB",LKR:"si",LRD:"en_LR",LSL:"en_LS",LYD:"ar_LY",MAD:"ar",MDL:"ro",MGA:"fr_MG",MKD:"mk",MMK:"my",MNT:"mn",MOP:"zh",MRO:"ar_MR",MRU:"ar_MR",MUR:"en_MU",MVR:"en",MWK:"en",MXN:"es_MX",MYR:"ms_MY",MZN:"pt_MZ",NAD:"en_NA",NGN:"en_NG",NIO:"es_NI",NOK:"nb_NO",NPR:"ne",NZD:"en_NZ",OMR:"ar_OM",PAB:"es_PA",PEN:"es_PE",PGK:"en_PG",PHP:"fil",PKR:"ur_PK",PLN:"pl",PYG:"es_PY",QAR:"ar_QA",RON:"ro",RSD:"sr",RUB:"ru",RWF:"rw",SAR:"ar_SA",SBD:"en_SB",SCR:"en_SC",SDG:"ar_SD",SEK:"sv_SE",SGD:"en_SG",SHP:"en_SH",SLL:"en_SL",SOS:"so_SO",SRD:"nl_SR",SSP:"en",STD:"pt_ST",STN:"pt_ST",SYP:"ar_SY",SZL:"en_SZ",THB:"th",TJS:"en",TMT:"tk",TND:"ar_TN",TOP:"to",TRY:"tr_TR",TTD:"en_TT",TWD:"zh_Hant_TW",TZS:"sw_TZ",UAH:"uk",UGX:"en_UG",USD:"en_US",UYU:"es_UY",UZS:"uz",VEF:"es_VE",VND:"vi",VUV:"en_BI",WST:"en_AS",XAF:"fr",XCD:"en",XOF:"fr",XPF:"fr_PF",YER:"ar_YE",ZAR:"zu",ZMW:"en_ZM",ZWL:"en_ZW"};return t[e]?t[e].replace("_","-"):"en-US"}_getCurrencies(){return[{currency:"US Dollar",sign:"$",abbreviation:"USD"},{currency:"Afghan Afghani",sign:"Af.",abbreviation:"AFN"},{currency:"Albanian Lek",sign:"Lek",abbreviation:"ALL"},{currency:"Algerian Dinar",sign:"din",abbreviation:"DZD"},{currency:"Angolan Kwanza",sign:"Kz",abbreviation:"AOA"},{currency:"Argentine Peso",sign:"$",abbreviation:"ARS"},{currency:"Armenian Dram",sign:"Dram",abbreviation:"AMD"},{currency:"Aruban Florin",sign:"Afl.",abbreviation:"AWG"},{currency:"Australian Dollar",sign:"$",abbreviation:"AUD"},{currency:"Azerbaijani Manat",sign:"",abbreviation:"AZN"},{currency:"Bahamian Dollar",sign:"$",abbreviation:"BSD"},{currency:"Bahraini Dinar",sign:"din",abbreviation:"BHD"},{currency:"Bangladeshi Taka",sign:"",abbreviation:"BDT"},{currency:"Barbadian Dollar",sign:"$",abbreviation:"BBD"},{currency:"Belarusian Ruble",sign:".",abbreviation:"BYN"},{currency:"Belarusian Ruble",sign:".",abbreviation:"BYR"},{currency:"Belize Dollar",sign:"$",abbreviation:"BZD"},{currency:"Bermudan Dollar",sign:"$",abbreviation:"BMD"},{currency:"Bhutanese Ngultrum",sign:"Nu.",abbreviation:"BTN"},{currency:"Bolivian Boliviano",sign:"Bs",abbreviation:"BOB"},{currency:"Bosnia-Herzegovina Convertible Mark",sign:"KM",abbreviation:"BAM"},{currency:"Botswanan Pula",sign:"P",abbreviation:"BWP"},{currency:"Brazilian Real",sign:"R$",abbreviation:"BRL"},{currency:"British Pound Sterling",sign:"",abbreviation:"GBP"},{currency:"Brunei Dollar",sign:"$",abbreviation:"BND"},{currency:"Bulgarian Lev",sign:".",abbreviation:"BGN"},{currency:"Burundian Franc",sign:"FBu",abbreviation:"BIF"},{currency:"Cambodian Riel",sign:"Riel",abbreviation:"KHR"},{currency:"Canadian Dollar",sign:"$",abbreviation:"CAD"},{currency:"Cape Verdean Escudo",sign:"CVE",abbreviation:"CVE"},{currency:"Cayman Islands Dollar",sign:"$",abbreviation:"KYD"},{currency:"CFA Franc BCEAO",sign:"CFA",abbreviation:"XOF"},{currency:"CFA Franc BEAC",sign:"FCFA",abbreviation:"XAF"},{currency:"CFP Franc",sign:"FCFP",abbreviation:"XPF"},{currency:"Chilean Peso",sign:"$",abbreviation:"CLP"},{currency:"Chinese Yuan",sign:"",abbreviation:"CNY"},{currency:"Chinese Yuan (offshore)",sign:"",abbreviation:"RMB"},{currency:"Colombian Peso",sign:"$",abbreviation:"COP"},{currency:"Comorian Franc",sign:"CF",abbreviation:"KMF"},{currency:"Congolese Franc",sign:"FrCD",abbreviation:"CDF"},{currency:"Costa Rican Colon",sign:"",abbreviation:"CRC"},{currency:"Croatian Kuna",sign:"kn",abbreviation:"HRK"},{currency:"Cuban Convertible Peso",sign:"$",abbreviation:"CUC"},{currency:"Cuban Peso",sign:"$",abbreviation:"CUP"},{currency:"Czech Republic Koruna",sign:"K",abbreviation:"CZK"},{currency:"Danish Krone",sign:"kr.",abbreviation:"DKK"},{currency:"Djiboutian Franc",sign:"Fdj",abbreviation:"DJF"},{currency:"Dominican Peso",sign:"RD$",abbreviation:"DOP"},{currency:"East Caribbean Dollar",sign:"$",abbreviation:"XCD"},{currency:"Egyptian Pound",sign:"",abbreviation:"EGP"},{currency:"Eritrean Nakfa",sign:"Nfk",abbreviation:"ERN"},{currency:"Ethiopian Birr",sign:"Birr",abbreviation:"ETB"},{currency:"Euro",sign:"",abbreviation:"EUR"},{currency:"Falkland Islands Pound",sign:"",abbreviation:"FKP"},{currency:"Fijian Dollar",sign:"$",abbreviation:"FJD"},{currency:"Gambian Dalasi",sign:"GMD",abbreviation:"GMD"},{currency:"Georgian Lari",sign:"GEL",abbreviation:"GEL"},{currency:"Ghanaian Cedi",sign:"GHS",abbreviation:"GHS"},{currency:"Gibraltar Pound",sign:"",abbreviation:"GIP"},{currency:"Guatemalan Quetzal",sign:"Q",abbreviation:"GTQ"},{currency:"Guinean Franc",sign:"FG",abbreviation:"GNF"},{currency:"Guyanaese Dollar",sign:"$",abbreviation:"GYD"},{currency:"Haitian Gourde",sign:"HTG",abbreviation:"HTG"},{currency:"Honduran Lempira",sign:"L",abbreviation:"HNL"},{currency:"Hong Kong Dollar",sign:"$",abbreviation:"HKD"},{currency:"Hungarian Forint",sign:"Ft",abbreviation:"HUF"},{currency:"Icelandic Krona",sign:"kr",abbreviation:"ISK"},{currency:"Indian Rupee",sign:"",abbreviation:"INR"},{currency:"Indonesian Rupiah",sign:"Rp",abbreviation:"IDR"},{currency:"Iranian Rial",sign:"Rial",abbreviation:"IRR"},{currency:"Iraqi Dinar",sign:"din",abbreviation:""},{currency:"Israeli New Sheqel",sign:" ",abbreviation:"ILS"},{currency:"Jamaican Dollar",sign:"$",abbreviation:"JMD"},{currency:"Japanese Yen",sign:"",abbreviation:"JPY"},{currency:"Jordanian Dinar",sign:"din",abbreviation:"JOD"},{currency:"Kazakhstani Tenge",sign:"",abbreviation:"KZT"},{currency:"Kenyan Shilling",sign:"Ksh",abbreviation:"KES"},{currency:"Kuwaiti Dinar",sign:"din",abbreviation:"KWD"},{currency:"Kyrgystani Som",sign:"KGS",abbreviation:"KGS"},{currency:"Laotian Kip",sign:"",abbreviation:"LAK"},{currency:"Lebanese Pound",sign:"L",abbreviation:"LBP"},{currency:"Lesotho Loti",sign:"LSL",abbreviation:"LSL"},{currency:"Liberian Dollar",sign:"$",abbreviation:"LRD"},{currency:"Libyan Dinar",sign:"din",abbreviation:"LYD"},{currency:"Lithuanian Litas",sign:"Lt",abbreviation:"LTL"},{currency:"Macanese Pataca",sign:"MOP",abbreviation:"MOP"},{currency:"Macedonian Denar",sign:"din",abbreviation:"MKD"},{currency:"Malagasy Ariary",sign:"Ar",abbreviation:"MGA"},{currency:"Malawian Kwacha",sign:"MWK",abbreviation:"MWK"},{currency:"Malaysian Ringgit",sign:"RM",abbreviation:"MYR"},{currency:"Maldivian Rufiyaa",sign:"Rf",abbreviation:"MVR"},{currency:"Mauritanian Ouguiya",sign:"MRO",abbreviation:"MRO"},{currency:"Mauritian Rupee",sign:"MURs",abbreviation:"MUR"},{currency:"Mexican Peso",sign:"$",abbreviation:"MXN"},{currency:"Moldovan Leu",sign:"MDL",abbreviation:"MDL"},{currency:"Mongolian Tugrik",sign:"",abbreviation:"MNT"},{currency:"Moroccan Dirham",sign:"dh",abbreviation:"MAD"},{currency:"Mozambican Metical",sign:"MTn",abbreviation:"MZN"},{currency:"Myanma Kyat",sign:"K",abbreviation:"MMK"},{currency:"Namibian Dollar",sign:"$",abbreviation:"NAD"},{currency:"Nepalese Rupee",sign:"Rs",abbreviation:"NPR"},{currency:"Netherlands Antillean Guilder",sign:"NAf.",abbreviation:"ANG"},{currency:"New Taiwan Dollar",sign:"NT$",abbreviation:"TWD"},{currency:"New Zealand Dollar",sign:"$",abbreviation:"NZD"},{currency:"Nicaraguan Cordoba",sign:"C$",abbreviation:"NIO"},{currency:"Nigerian Naira",sign:"",abbreviation:"NGN"},{currency:"North Korean Won",sign:"KP",abbreviation:"KPW"},{currency:"Norwegian Krone",sign:"kr",abbreviation:"NOK"},{currency:"Omani Rial",sign:"Rial",abbreviation:"OMR"},{currency:"Pakistani Rupee",sign:"Rs",abbreviation:"PKR"},{currency:"Panamanian Balboa",sign:"B/.",abbreviation:"PAB"},{currency:"Papua New Guinean Kina",sign:"PGK",abbreviation:"PGK"},{currency:"Paraguayan Guarani",sign:"Gs.",abbreviation:"PYG"},{currency:"Peruvian Nuevo Sol",sign:"S/.",abbreviation:"PEN"},{currency:"Philippine Peso",sign:"",abbreviation:"PHP"},{currency:"Polish Zloty",sign:"z",abbreviation:"PLN"},{currency:"Qatari Rial",sign:"Rial",abbreviation:"QAR"},{currency:"Romanian Leu",sign:"RON",abbreviation:"RON"},{currency:"Russian Ruble",sign:"",abbreviation:"RUB"},{currency:"Rwandan Franc",sign:"RF",abbreviation:"RWF"},{currency:"Saint Helena Pound",sign:"",abbreviation:"SHP"},{currency:"Samoan Tala",sign:"WST",abbreviation:"WST"},{currency:"Sao Tomean Dobra",sign:"Db",abbreviation:"STD"},{currency:"Saudi Riyal",sign:"Rial",abbreviation:"SAR"},{currency:"Serbian Dinar",sign:"din",abbreviation:"RSD"},{currency:"Seychellois Rupee",sign:"SCR",abbreviation:"SCR"},{currency:"Sierra Leonean Leone",sign:"SLL",abbreviation:"SLL"},{currency:"Singapore Dollar",sign:"$",abbreviation:"SGD"},{currency:"Solomon Islands Dollar",sign:"$",abbreviation:"SBD"},{currency:"Somali Shilling",sign:"SOS",abbreviation:"SOS"},{currency:"South African Rand",sign:"R",abbreviation:"ZAR"},{currency:"South Korean Won",sign:"",abbreviation:"KRW"},{currency:"South Sudanese Pound",sign:"",abbreviation:"SSP"},{currency:"Sri Lankan Rupee",sign:"Rs",abbreviation:"LKR"},{currency:"Sudanese Pound",sign:"SDG",abbreviation:"SDG"},{currency:"Surinamese Dollar",sign:"$",abbreviation:"SRD"},{currency:"Swazi Lilangeni",sign:"SZL",abbreviation:"SZL"},{currency:"Swedish Krona",sign:"kr",abbreviation:"SEK"},{currency:"Swiss Franc",sign:"CHF",abbreviation:"CHF"},{currency:"Syrian Pound",sign:"",abbreviation:"SYP"},{currency:"Tajikistani Somoni",sign:"Som",abbreviation:"TJS"},{currency:"Tanzanian Shilling",sign:"TSh",abbreviation:"TZS"},{currency:"Thai Baht",sign:"",abbreviation:"THB"},{currency:"Tongan Pa'anga",sign:"T$",abbreviation:"TOP"},{currency:"Trinidad and Tobago Dollar",sign:"$",abbreviation:"TTD"},{currency:"Tunisian Dinar",sign:"din",abbreviation:"TND"},{currency:"Turkish Lira",sign:"",abbreviation:"TRY"},{currency:"Turkmenistani Manat",sign:"m",abbreviation:"TMT"},{currency:"Ugandan Shilling",sign:"UGX",abbreviation:"UGX"},{currency:"Ukrainian Hryvnia",sign:".",abbreviation:"UAH"},{currency:"United Arab Emirates Dirham",sign:"dh",abbreviation:"AED"},{currency:"Uruguayan Peso",sign:"$",abbreviation:"UYU"},{currency:"Uzbekistan Som",sign:"som",abbreviation:"UZS"},{currency:"Vanuatu Vatu",sign:"VUV",abbreviation:"VUV"},{currency:"Venezuelan Bolivar",sign:"Bs",abbreviation:"VEF"},{currency:"Venezuelan Bolivar",sign:"Bs",abbreviation:"VES"},{currency:"Vietnamese Dong",sign:"",abbreviation:"VND"},{currency:"Yemeni Rial",sign:"Rial",abbreviation:"YER"},{currency:"Zambian Kwacha",sign:"ZMW",abbreviation:"ZMW"},{currency:"Zimbabwean Dollar",sign:"$",abbreviation:"ZWD"}].map((e=>(e.label=e.currency,e.menuLabel='<div style="display: flex; justify-content: space-between;"><span>'+e.currency+'</span><span style="opacity: 0.7;">'+e.sign+" 1,000.00</span></div>",e.value=e.abbreviation,e)))}_openAddStackColumnDialog(e,t,a){const l=this,i=l._dialogAddStackColumn||l._createDialog(l.editing.addColumnDialog),n=e?l.localize("dialogEditColumn",{value:e.label}):l.localize("dialogAddColumn"),o=i.querySelector(".smart-footer").querySelector(".smart-stack-layout"),r=l._getAddStackColumnDialogTemplate();i.classList.add("smart-grid-dialog-add-column"),i.type="add",i.editColumn=e||null,e&&e.element&&e.element.setAttribute("focus",""),o.classList.remove("right"),o.classList.add("center"),l._cellEditors||(l._cellEditors=[]),i.header.innerHTML=n,i.header.parentElement.classList.add("smart-hidden"),i.callback=a,!0===t&&(i.header.parentElement.classList.remove("smart-hidden"),"kanban"===l.view?(i.header.innerHTML=l.localize("dialogAddColumnStatus"),i.header.parentElement.querySelector(".smart-close-button").classList.add("smart-hidden"),i.classList.add("view")):i.classList.remove("kanban")),i.stackLabel&&i.stackLabel.classList.add("smart-hidden"),l.cancelEdit(),i.content&&(i.content.innerHTML="");const s=document.createElement("div");s.classList.add("smart-content-layout-container"),i.content.appendChild(s),l._addStackColumnDialogEditors=[];const d=l._addStackColumnDialogEditors;if(l._initAddColumnDialogEditors(d,r,i,s),!l._dialogAddStackColumn){i.modal=!0,i.btnConfirm.innerHTML=l.localize("dialogEditButtonConfirm"),i.btnCancel.innerHTML=l.localize("dialogEditButtonCancel"),i.onOpen=function(){const e=l._dialogAddStackColumn,t=l._getAddStackColumnDialogTemplate(),a=l._addStackColumnDialogEditors;l._addColumnDialogInitEditors(e,t,a),l._addColumnDialogShowHideEditors(e);const i=l.offset(l.$.columnHeader),n=l.$.columnHeader.offsetHeight,o=l.offset(l);if(e.style.maxHeight="",e.style.minHeight="",i.top+n+e.offsetHeight>window.innerHeight-o.top){const t=n+i.top+e.offsetHeight-window.innerHeight+o.top;e.style.maxHeight=Math.max(250,e.offsetHeight-t)+"px",e.style.minHeight="250px"}else e.style.maxHeight="",e.style.minHeight=""},i.onClose=function(){i.editColumn&&i.editColumn.element&&i.editColumn.element.removeAttribute("focus"),i.classList.remove("view"),i.callback&&i.callback(i.result)},i.btnCancel.onclick=function(){i.result=!1,i.close()},i.btnClose.onclick=function(){i.result=!1,i.close()},i.btnConfirm.onclick=function(){l._confirmAddColumnDialog(i),i.result=!0,i.close()},i.onkeydown=function(e){"Escape"===e.key&&"kanban"!==l.view&&(i.result=!1,i.close())},l._dialogAddStackColumn=i;const e=document.createElement("div");e.classList.add("smart-content-layout-container"),i.content.appendChild(e)}const c=()=>{if(window.screen.availWidth<400)return i.open("left","top"),i.style.width=l.offsetWidth+"px",void(i.style.height=l.offsetHeight+"px");{const e=l.editing.addColumnDialog;i.style.width="auto"===e.width?e.width:e.width+"px",i.style.height="auto"===e.height?e.height:e.height+"px"}i.open("center","center"),i.classList.add("center")};c(),i.refresh=()=>{c()}}_openImagePreviewDialog(e){const t=this,a=e?[...e.parentNode.parentNode.querySelectorAll("img")]:[];let l=e.hasAttribute("data-url")?e.getAttribute("data-url"):e.src;if((e=e.cloneNode()).src=l,!t._dialogImagePreview){t._dialogImagePreview=t._createDialog({modal:!0,screenModal:!0,left:"screenMiddle",top:"screenCenter",width:"80%",height:"80%"}),t._dialogImagePreview.content.innerHTML='<div style="width: 100%; height: 100%;"><div class="images-container"></div><div class="image-preview"></div></div>';const e=t._dialogImagePreview.content.firstElementChild;e.style.display="grid",e.style.gridTemplateColumns="50px 1fr"}const i=t._dialogImagePreview.querySelector(".images-container");i.innerHTML="";const n=(e,a)=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const l=150+Math.min(850,e.naturalWidth),i=150+Math.min(650,e.naturalHeight);t._dialogImagePreview.style.width=l+"px",t._dialogImagePreview.style.height=i+"px",!1!==a&&(t._dialogImagePreview.style.left="calc(50% - "+Math.min(850,t._dialogImagePreview.offsetWidth/2)+"px)",t._dialogImagePreview.style.top="calc(50% - "+Math.min(650,t._dialogImagePreview.offsetHeight/2)+"px)");const n=getComputedStyle(t._dialogImagePreview),o=parseInt(n.top),r=parseInt(n.left);if((window.offsetWidth<l||window.offsetHeight<i||o<0||r<0)&&(t._dialogImagePreview.style.left="0px",t._dialogImagePreview.style.top="0px",t._dialogImagePreview.style.width="100%",t._dialogImagePreview.style.height="100%"),o+i>window.innerHeight){const e=o+i-window.innerHeight;t._dialogImagePreview.style.height=i-e-20+"px"}e.style.maxWidth="100%"},o=()=>{const e=t._dialogImagePreview.querySelector(".images-container");let a=-1;return e.querySelectorAll("img").forEach(((e,t)=>{if(e.hasAttribute("active"))return a=t,!0})),a},r=e=>{const a=t._dialogImagePreview.querySelector(".images-container");e&&(e.hasAttribute("active")||a.querySelectorAll("img").forEach((t=>{t.style.borderColor="transparent",t.removeAttribute("active");let a=t.hasAttribute("data-url")?t.getAttribute("data-url").replaceAll("\\","/"):"";if(t.src===e.src||a===e.src){t.style.borderColor="var(--smart-primary)",t.setAttribute("active","");let e=t.src;t.hasAttribute("data-url")&&(e=t.getAttribute("data-url")),s.innerHTML=`<img src="${e}"/>`;const a=s.querySelector("img");a.onload=()=>{n(a,!1)}}})))};if(a.length>1)for(let t=0;t<a.length;t++){const l=a[t].cloneNode();l.style.width="40px",l.style.height="40px",l.style.cursor="pointer",l.style.borderStyle="solid",l.style.borderWidth="1px",l.style.borderColor="transparent",l.style.borderRadius="var(--smart-border)",l.style.marginTop="10px",l.title=a[t].title||a[t].parentNode.title,a[t].src===e.src&&(l.style.borderColor="var(--smart-primary)",l.setAttribute("active","")),i.appendChild(l),l.onmouseenter=()=>{l.style.borderColor="var(--smart-primary)"},l.onmouseleave=()=>{l.hasAttribute("active")||(l.style.borderColor="transparent")},l.onclick=()=>{r(l)}}const s=t._dialogImagePreview.content.querySelector(".image-preview");s.innerHTML="",s.appendChild(e),t._dialogImagePreview.btnClose.onclick=e=>{t._dialogImagePreview.close(),e.preventDefault(),e.stopPropagation()},e.style.marginLeft="auto",e.style.marginRight="auto",e.style.maxWidth="",e.onload=()=>{n(e)},t._dialogImagePreview.content.onpointerdown=t._dialogImagePreview.content.onpointerup=e=>{e.preventDefault(),e.stopPropagation()},t._dialogImagePreview.onkeydown=function(e){if("Escape"===e.key&&t._dialogImagePreview.close(),"ArrowUp"===e.key||"ArrowLeft"===e.key){const t=o();r(a[t-1]),e.stopPropagation(),e.preventDefault()}else if("ArrowDown"===e.key||"ArrowRight"===e.key){const t=o();r(a[t+1]),e.stopPropagation(),e.preventDefault()}},t._dialogImagePreview.btnClose.tabIndex=0,t._dialogImagePreview.onOpen=()=>{setTimeout((()=>{t._dialogImagePreview.btnClose.focus()}),100)},t._dialogImagePreview.footer.remove(),t._dialogImagePreview.header.parentNode.style.backgroundColor="var(--smart-background)",t._dialogImagePreview.open(),e&&r(e)}_getFileFromBase64(e,t){let a=e.split(","),l=a[0].match(/:(.*?);/)[1],i=atob(a[1]),n=i.length,o=new Uint8Array(n);for(;n--;)o[n]=i.charCodeAt(n);return new File([o],t,{type:l})}_getBase64(e,t){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){t(a.result)},a.onerror=function(){t("error")}}_findIsFile(e){return"string"==typeof e&&(e.indexOf("http")>=0||e.indexOf("base64")>=0||e.indexOf('[{"value":"/')>=0)}_findUserFile(e){const t=this;if(e&&e.value.startsWith("/"))return!0;if(t.uploadSettings.userFiles)for(let a=0;a<t.uploadSettings.userFiles.length;a++){const l=t.uploadSettings.userFiles[a];if(l){let t=e.name||e.label;if(!t&&!e.label&&e.value){const a=e.value.split("/");t=a[a.length-1]}if(l.label===t)return l;if(l.label.indexOf("_")>=0&&(l.label.substring(0,l.label.lastIndexOf("_"))+l.label.substring(l.label.indexOf("."))).indexOf(t)>=0)return l;const a=l.value.replaceAll("\\","/");if(a===e.value||a===e.url)return l}}return null}_removeFiles(){const e=this,t=e._dialogFile,a=(t.preview.querySelectorAll(".item"),t.fileUpload),l=t.cell.value&&t.cell.value.indexOf("[{")>=0?JSON.parse(t.cell.value):[];if(e.uploadSettings.removeUrl){let i=new FormData,n=new XMLHttpRequest;for(let n=0;n<a.files.length;n++){let o=l[n]?l[n]:e.uploadSettings.url+"/"+a.files[n].name;if(t&&t.cell&&t.cell.value&&t.cell.value.indexOf("[")>=0){const e=JSON.parse(t.cell.value);for(let t=0;t<e.length;t++)if(e[t].label===a.files[n].name){o=e[t].value;break}}e._findUserFile(a.files[n])||i.append(e.uploadSettings.name,a.files[n])}for(let a=0;a<t.uploadedWithLink.length;a++){const l=t.uploadedWithLink[a];e._findUserFile(l)||i.append(e.uploadSettings.name,l)}n.open("POST",e.uploadSettings.removeUrl),n.send(i)}if(e.uploadSettings.onUploadRemove){const l=t.cell.value&&t.cell.value.indexOf("[{")>=0?JSON.parse(t.cell.value):[];for(let t=0;t<a.files.length;t++)l&&l[t]?e.uploadSettings.onUploadRemove(l[t]):e.uploadSettings.removeUrl&&e.uploadSettings.onUploadRemove(e.uploadSettings.removeUrl+"/"+a.files[t].name)}t.uploadedWithLink=[],a.value="",t.input.value="",e._updateFilePreview(),t.tabs[2].classList.contains("active")&&t.tabs[2].click()}_removeFile(e){const t=this,a=t._dialogFile,l=a.preview.querySelectorAll(".item"),i=e.name||e.label,n=a.fileUpload,o=new DataTransfer;l.forEach((e=>{let t=!0;e.file.name!==i&&e.file.label!==i||(t=!1),e.file.value&&(t=!1),t&&o.items.add(e.file)})),n.files=o.files,a.clearButton&&0===l.length&&a.clearButton.classList.remove("show");let r=t.uploadSettings.url+"/"+i;if(a&&a.cell&&a.cell.value&&a.cell.value.indexOf("[")>=0){const e=JSON.parse(a.cell.value);for(let t=0;t<e.length;t++)if(e[t].label===i){r=e[t].value;break}}let s=-1;for(let e=0;e<a.uploadedWithLink.length;e++){const t=a.uploadedWithLink[e];if(t&&t.label===i){s=e;break}}if(s>=0&&a.uploadedWithLink.splice(s,1),t.uploadSettings.userFiles)for(let e=0;e<t.uploadSettings.userFiles.length;e++){const l=t.uploadSettings.userFiles[e];if(l&&l.label===i)return void(a.tabs[2].classList.contains("active")&&a.tabs[2].click())}if(t.uploadSettings.onUploadRemove){let e=r;t.uploadSettings.onUploadRemove(e)}if(t.uploadSettings.removeUrl){let e=new FormData,a=new XMLHttpRequest;e.append(t.uploadSettings.name,r),a.open("POST",t.uploadSettings.removeUrl),a.send(e)}}getFileTypes(e){return e?["image/apng","image/bmp","image/gif","image/jpeg","image/jpg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon","video/x-msvideo","text/csv","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-fontobject","image/gif","application/json","text/plain","application/xml","application/zip","application/gzip","application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/x-7z-compressed","application/vnd.rar","application/rtf","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/x-zip-compressed"]:["image/apng","image/bmp","image/gif","image/jpeg","image/jpg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon"]}_getFileSize(e){return"string"==typeof e?e:e<1024?e+"bytes":e>=1024&&e<1048576?((e/1024).toFixed(1)+"KB").replace(".0",""):e>=1048576?(e/1048576).toFixed(1)+"MB":void 0}_getFileListItem(e){const t=this,a=t._dialogFile,l=a.acceptFiles,i=document.createElement("div");e.name||(e.name=e.label);const n=e.size||0;i.classList.add("item"),i.onpointerdown=n=>{const o=i.getBoundingClientRect();if(a.input.value="",n.clientY>=o.bottom-12)n.clientX>o.left+o.width/2-13&&n.clientX<o.left+o.width/2+13&&(i.remove(),t._removeFile(i.file));else if(l){if(e.value){const t=document.createElement("a");return t.href=e.value,t.target="_blank",void t.click()}const t=URL.createObjectURL(e),a=document.createElement("a");a.download=e.name,a.href=t,a.click()}else t._openImagePreviewDialog(i.querySelector("img"))};const o=document.createElement("div"),r=n?`, ${t._getFileSize(e.size)}.`:"";let s;return o.textContent=o.textContentTitle=`${e.name}${r}`,o.textContent.length>20&&(o.textContent=`${e.name.substring(0,5)}...${e.name.substring(e.name.length-4)} ${r}`),a.objectURL||(a.objectURL=[]),a.objectURL[e.name+"_"+n]||(e.small?a.objectURL[e.name+"_"+n]=e.small?e.small:URL.createObjectURL(e):e.medium?a.objectURL[e.name+"_"+n]=e.medium?e.medium:URL.createObjectURL(e):a.objectURL[e.name+"_"+n]=e.value?e.value:URL.createObjectURL(e)),l?(s=document.createElement("div"),s.classList.add("attachment","smart-grid-icon","show"),e.name.indexOf(".pdf")>=0?s.classList.add("smart-icon-pdf"):e.name.indexOf(".png")>=0||e.name.indexOf(".jpg")>=0||e.name.indexOf(".jpeg")>=0||e.name.indexOf(".gif")>=0?s.classList.add("smart-icon-image"):e.name.indexOf(".tsv")>=0||e.name.indexOf(".txt")>=0||e.name.indexOf(".csv")>=0?s.classList.add("smart-icon-text"):e.name.indexOf(".xls")>=0||e.name.indexOf(".xlsx")>=0?s.classList.add("smart-icon-excel"):e.name.indexOf(".ppt")>=0?s.classList.add("smart-icon-powerpoint"):e.name.indexOf(".zip")>=0||e.name.indexOf(".rar")>=0||e.name.indexOf(".7z")>=0?s.classList.add("smart-icon-archive"):e.name.indexOf(".doc")>=0||e.name.indexOf(".docx")>=0?s.classList.add("smart-icon-word"):s.classList.add("smart-icon-file")):(s=document.createElement("img"),s.loading="lazy",s.src=a.objectURL[e.name+"_"+n],s.onerror=()=>{if(i.style.display="none",a.uploadedWithLink.length){const t=a.uploadedWithLink.indexOf(e);t>=0&&a.uploadedWithLink.splice(t,1)}}),i.file=e,i.title=o.textContentTitle||o.textContent,i.appendChild(s),i.appendChild(o),i}_updateFilePreview(){const e=this,t=e._dialogFile,a=t.preview,l=t.fileUpload;for(;a.firstChild;)a.removeChild(a.firstChild);const i=()=>{const l=document.createElement("div");l.classList.add("list");const i=document.createElement("div");i.classList.add("smart-grid-icon","show","smart-icon-delete"),i.title=e.localize("clear"),a.appendChild(i),i.onclick=()=>{e._removeFiles()},t.clearButton=i,a.appendChild(l)},n=l.files;if(0===n.length)if(0===t.uploadedWithLink.length){const t=document.createElement("p");t.textContent=e.localize("dialogFileFileUpload"),a.appendChild(t)}else i();else{i();const o=new DataTransfer,r=t.column.editor.maxImages||e.uploadSettings.uploadMaxCount||5,s=t.column.editor.maxImageSize||e.uploadSettings.uploadMaxSize||524288;let d=0,c=[];for(const l of n){if(!e._validateFileType(l))continue;const i=e._getFileListItem(l);if(d>=r)c.push(l.name);else if(l.size>s){const t=document.createElement("p");t.textContent=t.textContentTitle=e.localize("dialogFileSize",{value:l.name,fileSize:e._getFileSize(s)}),a.appendChild(t)}else o.items.add(l),t.preview.querySelector(".list").appendChild(i),d++}if(c.length>0){const t=document.createElement("p");t.textContent=e.localize("dialogFileCount",{files:c.toString(),fileCount:r}),a.appendChild(t)}l.files=o.files}if(t.uploadedWithLink&&t.uploadedWithLink.length)for(let a=0;a<t.uploadedWithLink.length;a++){const l=t.uploadedWithLink[a];if(l){const a=e._getFileListItem(l);l.name=l.label,a.file=l,t.preview.lastChild.appendChild(a)}}}_validateFileType(e){return this.getFileTypes(this._dialogFile.acceptFiles).includes(e.type)}_getFileIndex(e){const t=this._dialogFile;let a=-1;for(let l=0;l<t.uploadedWithLink.length;l++){const i=t.uploadedWithLink[l];if(i.label===e.name||i.label===e.label&&(void 0!==i.label||void 0!==e.label)){a=l;break}if(i.name===e.name||i.name===e.label){a=l;break}if(e.label.indexOf(i.name.substring(0,i.name.indexOf(".")))>=0){a=l;break}}for(let l=0;l<t.fileUpload.files.length;l++){const i=t.fileUpload.files[l];if(i.label===e.name||i.label===e.label&&(void 0!==i.label||void 0!==e.label)){a=l;break}if(i.name===e.name||i.name===e.label){a=l;break}if(e.label.indexOf(i.name.substring(0,i.name.indexOf(".")))>=0){a=l;break}}return a}_openFileDialog(e,t=!1){const a=this,l=a._dialogFile||a._createDialog(),i='<span class="smart-grid-icon '+(!1===t?"smart-icon-image":"smart-icon-docs")+' show"></span>'+(!1===t?a.localize("dialogImageFileHeader"):a.localize("dialogFileHeader"));if(l.cell=e,l.header.innerHTML=i,l.column=e.column,l.acceptFiles=t,l.classList.add("smart-grid-image-dialog"),!a._dialogFile){l.modal=!0,l.btnConfirm.innerHTML=a.localize("dialogEditButtonConfirm"),l.btnCancel.innerHTML=a.localize("dialogEditButtonCancel");const e=()=>{l.loader&&l.loader.classList.add("smart-hidden"),l.close()};l.onOpen=function(){l.fileUpload.value="",l.input.value="",l.uploadedWithLink=[];let e=l.cell.editor.instance.getValue();if("[]"===e)return void l.tabs[0].click();l.tabs[0].click();let t=!0;const i=new DataTransfer;if(("string"==typeof e&&e.indexOf("base64")>=0||"string"==typeof e&&e.indexOf("[{")>=0)&&(e=JSON.parse(e)),Array.isArray(e)){let n=0;e.forEach((async o=>{if(t=!1,"string"==typeof o.value&&o.value.indexOf("base64")>=0&&(t=!0),t)i.items.add(a._getFileFromBase64(o.value,o.label));else{const t=(t,i)=>{a.uploadSettings.url&&(a._findUserFile(t)?(l.uploadedWithLink.push(t),n++,n===e.length&&a._updateFilePreview()):i("error"))};o.value.indexOf(window.location.host)>=0?t(o,(t=>{"error"!==t&&i.items.add(t),n++,n===e.length&&(l.fileUpload.files=i.files,a._updateFilePreview())})):(l.uploadedWithLink.push(o),n++,n===e.length&&a._updateFilePreview())}})),l.fileUpload.files=i.files,a._updateFilePreview()}else a._updateFilePreview()},l.onClose=function(){},l.btnCancel.onclick=function(){l.close()},l.btnClose.onclick=function(){l.close()},l.btnConfirm.onclick=function(){let i=[],n=[...l.fileUpload.files];l.loader?l.loader.classList.remove("smart-hidden"):(l.loader=document.createElement("div"),l.loader.classList.add("smart-grid-loader"),l.loader.style.width=l.loader.style.height="24px",l.btnConfirm.parentNode.insertBefore(l.loader,l.btnConfirm)),l.uploadedWithLink&&l.uploadedWithLink&&l.uploadedWithLink.length&&(i=i.concat(l.uploadedWithLink)),(()=>{if(l.cell.value&&"string"==typeof l.cell.value){const e=JSON.parse(l.cell.value);e&&e.length&&(n=n.filter((t=>{let a=!0;return e.forEach((e=>{if(e.label===t.name&&(a=!1,!a)){const t={value:e.value,label:e.label};e.small&&(t.small=e.small),e.medium&&(t.medium=e.medium),e.large&&(t.large=e.large),i.push(t)}})),a})))}})();const o=()=>{const t=l.cell.value;l.cell.editor.instance.setValue(i),!(a.editing.dialog.enabled&&a.editing.dialog.visible)&&(a._endCellEdit(l.cell),a._handleFileColumnHistory(l.cell.row,l.cell.column.dataField,t,i)),e()};if(a.uploadSettings.url){const r=(t,i)=>{const n=t.filter((e=>-1!==e.value.indexOf(window.location.host)));if(i&&i[0]&&"error"===i[0].response&&(a.cancelEdit(),e()),n.length===l.fileUpload.files.length+l.uploadedWithLink.length){(i.files||i[0])&&a.uploadSettings.onUploadCompleted&&a.uploadSettings.onUploadCompleted({files:l.fileUpload.files,status:200,serverResponse:i});const t=l.cell.column.dataField;let o=l.cell.value;l.cell.editor.instance.setValue(n),!(a.editing.dialog.enabled&&a.editing.dialog.visible)&&(a._endCellEdit(l.cell),a._handleFileColumnHistory(l.cell.row,t,o,n)),e()}};if(0===n.length&&0===l.uploadedWithLink.length)l.cell.editor.instance.setValue(i),!(a.editing.dialog.enabled&&a.editing.dialog.visible)&&a._endCellEdit(l.cell),e();else if(a.uploadSettings.singleFilePost){let e=!1;for(let o=0;o<n.length;o++){const s=[];s.push(n[o]),a._handleFileUpload(l,s,i,t?"file":"image",r),e=!0}for(let t=0;t<l.uploadedWithLink.length;t++){const n=[];a._findUserFile(l.uploadedWithLink[t])||(n.push(l.uploadedWithLink[t].value),a._handleFileUpload(l,n,i,"url",r),e=!0)}e||o()}else if(n.length&&a._handleFileUpload(l,n,i,t?"file":"image",r),l.uploadedWithLink.length){const e=l.uploadedWithLink.filter((e=>!a._findUserFile(e)));if(e.length){const t=e.map((e=>e.value));a._handleFileUpload(l,t,i,"url",r)}else i.length===l.fileUpload.files.length+l.uploadedWithLink.length&&o()}}else{let e=0;for(let t=0;t<n.length;t++){const l=n[t];a._getBase64(l,(t=>{"error"===t&&console.log("Image load error"),e++,i.push({value:t,label:l.name}),e===n.length&&o()}))}0===n.length&&o()}},l.onkeydown=function(e){"Escape"===e.key&&l.close()},a._dialogFile=l,l.content.innerHTML=`\n                <div>\n                    <div>\n                        <div class="tabs">\n                            <div class="active tab">\n                                <span class="smart-grid-icon smart-icon-plus show"></span><label>${a.localize("dialogFileDevice")}</label>\n                            </div>\n                            <div class="tab">\n                                <span class="smart-grid-icon smart-icon-link show"></span><label>${a.localize("dialogFileLink")}</label>\n                            </div>\n                            <div class="tab">\n                                <span class="smart-grid-icon smart-icon-cloud show"></span><label>${a.localize("dialogMyFiles")}</label>\n                            </div>\n                       </div>\n                    </div>\n                    <div class="smart-grid-drop-zone">\n                         <div>\n                            <div class="title"><span class="smart-grid-icon smart-icon-plus show"></span><label>${a.localize("dialogFileUpload")}</label></div>\n                            <div class="subtitle"><span class="smart-grid-icon smart-icon-docs show"></span><label>${a.localize("dialogFileDrop")}</label></div>\n                         </div> \n                         <input accept=".jpg, .jpeg, .png" type="file" multiple="multiple" style="display: none;">\n                    </div>\n                    <div class="smart-hidden url-zone">\n                        <div class="url-title">\n                        ${a.localize("dialogFileURL")}\n                        </div>\n                        <div class="upload">\n                            <smart-input placeholder="https://example.com/image.png" class="underlined"></smart-input>\n                            <br/>\n                            <smart-button disabled class="success">${a.localize("dialogFileURLUpload")}</smart-button>\n                        </div>\n                    </div>\n                    <div class="smart-hidden smart-grid-file-zone">\n             \n                        <div class="files">\n                        </div>\n                        <div class="subtitle"><span class="smart-grid-icon smart-icon-attention-circled show"></span><label>${a.localize("dialogMyFilesTitle")}</label></div>\n                     </div>\n                    <div class="preview">\n                    </div>\n                    <br/>\n                </div>`,l.input=l.querySelector("smart-input"),l.dropZone=l.querySelector(".smart-grid-drop-zone"),l.upload=l.querySelector(".title"),l.fileUpload=l.querySelector("input"),l.preview=l.querySelector(".preview"),l.tabs=l.querySelectorAll(".tab"),l.urlZone=l.querySelector(".url-zone"),l.fileZone=l.querySelector(".smart-grid-file-zone"),l.files=l.querySelector(".smart-grid-file-zone .files"),l.uploadButton=l.querySelector("smart-button"),l.input.accept=t?".jpg, .jpeg, .png, .pdf, .xls, .xlsx, .doc, .docx, .gif, .csv, .txt, .xml, .zip, .rtf, .ppt, .pptx, .avi, .html, .htm":".jpg, .jpeg, .png, .gif",l.dropZone.ondrop=l.dropZone.dropHere=e=>{if(e.preventDefault(),e.dataTransfer.items){let t=0;const i=l.column.editor.maxImages||5;for(let l=0;l<e.dataTransfer.items.length;l++)if("file"===e.dataTransfer.items[l].kind){const i=e.dataTransfer.items[l].getAsFile();a._validateFileType(i)&&t++}if(t===e.dataTransfer.files.length||t===i){const t=new DataTransfer;let n=[...e.dataTransfer.files],o=[...l.fileUpload.files];n.length>i&&(n=n.slice(0,5)),o.length>i&&(o=o.slice(0,5)),o.forEach(((e,a)=>{a<i&&t.items.add(e)})),n.forEach(((e,a)=>{a<i&&t.items.add(e)})),l.fileUpload.files=t.files,a._updateFilePreview()}}else l.fileUpload.files=e.dataTransfer.files,a._updateFilePreview()},l.dropZone.ondragover=e=>{e.preventDefault()},l.tabs[0].onclick=()=>{l.tabs[0].classList.add("active"),l.tabs[1].classList.remove("active"),l.tabs[2].classList.remove("active"),l.dropZone.classList.remove("smart-hidden"),l.fileZone.classList.add("smart-hidden"),l.urlZone.classList.add("smart-hidden")},l.tabs[1].onclick=()=>{l.tabs[0].classList.remove("active"),l.tabs[1].classList.add("active"),l.tabs[2].classList.remove("active"),l.dropZone.classList.add("smart-hidden"),l.fileZone.classList.add("smart-hidden"),l.urlZone.classList.remove("smart-hidden")},l.tabs[2].onclick=()=>{if(l.tabs[0].classList.remove("active"),l.tabs[1].classList.remove("active"),l.tabs[2].classList.add("active"),l.dropZone.classList.add("smart-hidden"),l.urlZone.classList.add("smart-hidden"),l.fileZone.classList.remove("smart-hidden"),l.files.innerHTML="",a.uploadSettings.userFiles&&a.uploadSettings.userFiles.length){const e=document.createDocumentFragment();a.uploadSettings.userFiles.forEach((t=>{Array.isArray(t)&&(t=t[0]);let i=t;"string"==typeof t.value&&t.value.indexOf("base64")>=0&&(t=a._getFileFromBase64(t.value,t.label)),t.type||(t.type="unknown");const n=a._getFileListItem(t);a._validateFileType(t)&&(a._getFileIndex(t)>=0&&n.classList.add("active"),n.onpointerdown=()=>{n.classList.toggle("active");let e=a._getFileIndex(t);n.classList.contains("active")?e<0&&l.uploadedWithLink.push({label:i.name||i.label,value:i.value}):a._removeFile(i),a._updateFilePreview()},e.appendChild(n))})),l.files.appendChild(e)}},l.uploadButton.onclick=()=>{const e=this,t=l.input.value,a=t.split("/"),i=a[a.length-1];if(l.column&&l.column.editor&&e.uploadSettings.url){const a={value:t,label:i},n=e._findUserFile(a);for(let e=0;e<l.uploadedWithLink.length;e++){if(l.uploadedWithLink[e].label===i)return;if(n&&l.uploadedWithLink[e].label===n.label)return}l.uploadedWithLink.push(n||a),e._updateFilePreview()}else{const a={value:t,label:i};for(let e=0;e<l.uploadedWithLink.length;e++)if(l.uploadedWithLink[e].label===i)return;l.uploadedWithLink.push(a),e._updateFilePreview()}l.input.value="",l.uploadButton.disabled=!0},l.fileUpload.onchange=()=>{if(0===l.fileUpload.files.length&&l._tempFiles)l.fileUpload.files=l._tempFiles;else if(l._tempFiles){const e=new DataTransfer,t=[...l.fileUpload.files],i=[...l._tempFiles];i.forEach((t=>{e.items.add(t)})),t.forEach((t=>{let l=!0;a._validateFileType(t)||(l=!1),i.forEach((e=>{e.name===t.name&&e.size===t.size&&e.lastModified===t.lastModified&&(l=!1)})),l&&e.items.add(t)})),l.fileUpload.files=e.files}a._updateFilePreview()},l.input.onchange=l.input.onblur=l.input.onkeyup=()=>{l.uploadButton.disabled=!l.input.value||!l.input.value.startsWith("https://");const e=l.input.value,t=e.split("/"),i=t[t.length-1];if(l.column&&l.column.editor&&a.uploadSettings.url){const t={value:e,label:i},n=a._findUserFile(t);for(let e=0;e<l.uploadedWithLink.length;e++)l.uploadedWithLink[e].label===i&&(l.uploadButton.disabled=!0),n&&l.uploadedWithLink[e].label===n.label&&(l.uploadButton.disabled=!0)}},l.upload.onclick=()=>{l._tempFiles=[];const e=new DataTransfer;[...l.fileUpload.files].forEach((t=>{e.items.add(t)})),l._tempFiles=e.files,l.fileUpload.click()}}l.fileUpload.accept=t?".jpg, .jpeg, .png, .pdf, .xls, .xlsx, .doc, .docx, .gif, .csv, .txt, .xml, .zip, .rtf, .ppt, .pptx, .avi, .html, .htm":".jpg, .jpeg, .png, .gif",l.open(),setTimeout((function(){l.btnConfirm.focus()}),100)}_handleFileUpload(e,t,a,l,i){const n=this;if(l||(l="image"),e.column&&e.column.editor&&n.uploadSettings.url){const o=new FormData,r=n.uploadSettings.url;let s=!1;const d=t[0],c=n.uploadSettings.data;c&&""!==c&&("string"==typeof c?o.append("postData",c):o.append("postData",JSON.stringify(c))),o.append("fileType",l);for(let e=0;e<t.length;e++)o.append(n.uploadSettings.name,t[e]),s=!0;let u=new XMLHttpRequest;u.open("POST",r),n.uploadSettings.onSetHeaders&&"function"==typeof n.uploadSettings.onSetHeaders&&n.uploadSettings.onSetHeaders(u,d),s&&n.$.fireEvent("uploadStarted",{files:t,size:d.size}),n.uploadSettings.onUploadStarted&&n.uploadSettings.onUploadStarted({files:t,status:u.status}),u.upload.onprogress=function(e){n.uploadSettings.onProgress&&n.uploadSettings.onProgress(e)},u.onabort=function(e){n.uploadSettings.onAbort&&n.uploadSettings.onAbort(e)},u.onerror=function(e){n.uploadSettings.onError&&n.uploadSettings.onError(e)},u.onload=function(){let e=!1;if(u.response&&("string"==typeof u.response?(e=u.response,e.indexOf("[{")>=0&&(e=JSON.parse(u.response))):e=JSON.parse(u.response)),u.status>=200&&u.status<=299){const o=(e,t)=>{if(e.response&&e.response.response&&"success"!==e.response.response)return null;let a=!1;u.fileURL&&(a=u.file_url);let l={};e&&e.file_url?a=e.file_url:e&&e[0]&&e[0].file_url&&(a=e[0].file_url);let i=!1;e&&e.file_url_small?i=e.file_url_small:e&&e[0]&&e[0].file_url_small&&(i=e[0].file_url_small);let n=!1;e&&e.file_url_medium?n=e.file_url_medium:e&&e[0]&&e[0].file_url_medium&&(n=e[0].file_url_medium);let o=!1;return e&&e.file_url_large?o=e.file_url_large:e&&e[0]&&e[0].file_url_large&&(o=e[0].file_url_large),a&&(l.value=a),i&&(l.small=i),n&&(l.medium=n),o&&(l.large=o),l.label=t,l};for(let i=0;i<t.length;i++){const r=t[i].name?[]:t[i].split("/"),s="url"===l?r[r.length-1]:t[i].name;n.uploadSettings.url;const d=o((e.files||e[0]&&e[0].files||[e[0]])[i],s);d&&a.push(d)}i(a,e)}else i(a,e),n.uploadSettings.onUploadError&&n.uploadSettings.onUploadError({files:t,status:u.status,serverResponse:e})},u.onreadystatechange=function(){e.column.editor.responseHandler&&"function"==typeof e.column.editor.responseHandler&&e.column.editor.responseHandler(u)},s&&u.send(o),n.uploadSettings.onChange&&n.uploadSettings.onChange(t)}}_handleFileColumnHistory(e,t,a,l){const i=this;if(i.storeHistory){a&&"string"==typeof a&&(a=(a=(a=JSON.parse(a)).map((e=>e.label))).toString()),a&&(Array.isArray(a)&&(a=a.map((e=>e.label))),a=a.toString()),null==a&&(a=""),l&&"string"==typeof l&&(l=(l=(l=JSON.parse(l)).map((e=>e.label))).toString()),null==l&&(l=""),l&&(Array.isArray(l)&&(l=l.map((e=>e.label))),l=l.toString());const n={user:i._currentUser.info.id,date:e.updatedDate};n.action=t,n.details={oldValue:a,value:l},e.addHistory(n)}}});