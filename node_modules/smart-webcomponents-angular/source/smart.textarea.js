
/* Smart UI v15.3.13 (2023-07-15) 
Copyright (c) 2011-2023 jQWidgets. 
License: https://htmlelements.com/license/ */ //

(()=>{Smart("smart-text-area",class extends Smart.Input{static get properties(){return{users:{value:[],type:"array",reflectToAttribute:!1},resize:{value:"none",type:"string"}}}template(){return'<div id="inputContainer" role="presentation"><textarea class="smart-input" id=\'input\' readonly=\'[[readonly]]\' placeholder=\'[[placeholder]]\'  name=\'[[name]]\' value=\'{{value::keyup}}\' disabled=\'[[disabled]]\' aria-label="[[placeholder]]"></textarea><span class="smart-hidden smart-hint" inner-h-t-m-l="[[hint]]" id="span"></span><div id="dropDownButton" tabindex=-1 class="smart-drop-down-button" role="button" aria-label="Toggle popup"><div id="arrow" class="arrow" aria-hidden="true"></div></div></div>'}propertyChangedHandler(e,t,i){const n=this;"users"===e?(delete n._initMenu,n._mentionMenu&&(n._mentionMenu.remove(),n._initUsersMention())):"resize"===e&&(n.$.input.style.resize=i,n._mentionTrigger&&("none"!==n.resize?n._mentionTrigger.style.right="10px":n._mentionTrigger.style.right="5px"))}detach(){const e=this;delete e._initMenu,e._mentionMenu&&e._mentionMenu.remove()}findMatches(){const e=this.$.input.value.split("").concat([" "]),t=[];let i="";for(let n in e){let s=e[n],r=e[n-1]||" ",o=[" ","\\n"].indexOf(r)>-1||10===r.charCodeAt(0);("@"===s&&o||i.length)&&" "!==s&&(i+=s),i.length&&" "===s&&(t.push({word:i,index:Math.max(n-i.length,0)}),i="")}return t}getMentions(){const e=this,t=this.findMatches(),i=[];return t.forEach((t=>{e.users.forEach((e=>{const n=t.word.replace("@","");e.name===n&&i.push(e)}))})),i}_initUsersMention(){const e=this;if(e._initMenu)return;e._initMenu=!0;const t=document.createElement("div");t.id=e.id+"_mention_menu",t.classList.add("smart-text-area-mention-menu","smart-hidden"),e._mentionMenu=t,document.body.appendChild(t),e._mentionPlugin=new Smart.Mention(e.$.input,t,(t=>""===t?e.users:e.users.filter((e=>e.name.startsWith(t)))),((e,t)=>`${t}${e.name} `),((e,t,i)=>{const n=document.createElement("div");return n.setAttribute("role","option"),n.className="smart-text-area-mention-menu-item",i&&(n.classList.add("selected"),n.setAttribute("aria-selected","")),n.textContent=e.name,n.onpointerdown=e=>{e.preventDefault(),t()},n}))}render(){const e=this;super.render();if(new ResizeObserver((()=>{"none"!==e.resize&&(e.style.width=parseInt(e.$.input.offsetWidth)+2+"px",e.style.height=parseInt(e.$.input.offsetHeight)+2+"px")})).observe(e.$.input),e._initUsersMention(),e.$.input.style.resize=e.resize,e.users&&e.users.lenght){e.setAttribute("has-users","");const t=document.createElement("span");t.innerHTML="@",t.style.position="absolute",t.classList.add("smart-hidden"),t.classList.add("smart-mention-trigger"),t.style.bottom="3px","none"!==e.resize?t.style.right="10px":t.style.right="5px",t.style.cursor="pointer",t.onpointerdown=t=>{const i=this.$.input.selectionEnd,n=this.$.input.value.slice(0,i),s=this.$.input.value.substring(i);if(n.length>1&&n.substring(n.length-2).indexOf("@")>=0)return this.$.input.dispatchEvent(new Event("input")),void t.preventDefault();n.length>0?(this.$.input.value=n+" @"+s,this.$.input.selectionStart=this.$.input.selectionEnd=i+2):0===e.$.input.selectionStart&&(this.$.input.value=n+"@ "+s,this.$.input.selectionStart=this.$.input.selectionEnd=1),this.$.input.dispatchEvent(new Event("input")),t.preventDefault()},e._mentionTrigger=t,e.addEventListener("focus",(()=>{t.classList.remove("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.addEventListener("blur",(()=>{t.classList.add("smart-hidden"),e._mentionPlugin&&e._mentionPlugin.refreshMenu()})),e.onmouseenter=()=>{t.classList.remove("smart-hidden")},e.onmouseleave=()=>{t.classList.add("smart-hidden")},e.$.inputContainer.appendChild(t)}e.classList.add("smart-input")}});const e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"];function t(t,i){const n=document.createElement("div");document.body.appendChild(n);const s=n.style,r=getComputedStyle(t);s.whiteSpace="pre-wrap",s.wordWrap="break-word",s.position="absolute",s.visibility="hidden",e.forEach((e=>{s[e]=r[e]})),s.overflow="hidden",n.textContent=t.value.substring(0,i);const o=document.createElement("span");o.textContent=t.value.substring(i)||".",n.appendChild(o);const h={top:o.offsetTop+parseInt(r.borderTopWidth),left:o.offsetLeft+parseInt(r.borderLeftWidth),height:o.offsetHeight};return n.remove(),h}Smart.Mention=class{constructor(e,t,i,n,s){this.ref=e,this.menuRef=t,this.resolveFn=i,this.replaceFn=n,this.menuItemFn=s,this.options=[],this.makeOptions=this.makeOptions.bind(this),this.closeMenu=this.closeMenu.bind(this),this.selectItem=this.selectItem.bind(this),this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.renderMenu=this.renderMenu.bind(this),this.ref.addEventListener("input",this.onInput),this.ref.addEventListener("keydown",this.onKeyDown)}async makeOptions(e){const t=await this.resolveFn(e);0!==t.lenght?(this.options=t,this.renderMenu()):this.closeMenu()}closeMenu(){setTimeout((()=>{this.options=[],this.left=void 0,this.top=void 0,this.triggerIdx=void 0,this.renderMenu()}),0)}selectItem(e){return()=>{const t=this.ref.value.substr(0,this.triggerIdx),i=this.options[e],n=this.replaceFn(i,this.ref.value[this.triggerIdx]),s=this.ref.value.substr(this.ref.selectionStart),r=`${t}${n}${s}`;this.ref.value=r,this.ref.ownerElement&&(this.ref.ownerElement.value=r);const o=this.ref.value.length-s.length;this.ref.setSelectionRange(o,o),this.ref.dispatchEvent(new Event("input")),this.closeMenu(),this.ref.focus()}}onInput(e){const i=this.ref.selectionStart,n=this.ref.value.slice(0,i),s=n.split(/\s/),r=s[s.length-1],o=n.endsWith(r)?n.length-r.length:-1;if(!("@"===n[o]))return void this.closeMenu();const h=n.slice(o+1);this.makeOptions(h);const a=t(this.ref,i),{top:d,left:l}=this.ref.getBoundingClientRect();setTimeout((()=>{this.active=0,this.left=window.scrollX+a.left+l+this.ref.scrollLeft,this.top=window.scrollY+a.top+d+a.height-this.ref.scrollTop,this.triggerIdx=o,this.renderMenu()}),0)}refreshMenu(){void 0!==this.triggerIdx&&null!==this.triggerIdx&&(this.ref===document.activeElement?this.triggerIdx&&this.menuRef.classList.remove("smart-hidden"):this.menuRef.classList.add("smart-hidden"),setTimeout((()=>{const e=this.ref.selectionStart,i=t(this.ref,e),{top:n,left:s}=this.ref.getBoundingClientRect();this.left=window.scrollX+i.left+s+this.ref.scrollLeft,this.top=window.scrollY+i.top+n+i.height-this.ref.scrollTop,this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px"})))}onKeyDown(e){let t=!1;if(void 0!==this.triggerIdx)switch(e.key){case"ArrowDown":this.active=Math.min(this.active+1,this.options.length-1),this.renderMenu(),t=!0;break;case"ArrowUp":this.active=Math.max(this.active-1,0),this.renderMenu(),t=!0;break;case"Enter":case"Tab":this.selectItem(this.active)(),t=!0}t&&e.preventDefault()}renderMenu(){return void 0===this.top?(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden")):this.options.length?(this.menuRef.style.left=this.left+"px",this.menuRef.style.top=this.top+"px",this.menuRef.innerHTML="",this.ref===document.activeElement&&this.menuRef.classList.remove("smart-hidden"),this.options.forEach(((e,t)=>{this.menuRef.appendChild(this.menuItemFn(e,this.selectItem(t),this.active===t))})),this.menuRef.hidden=!1,void this.menuRef.classList.remove("smart-hidden")):(this.menuRef.hidden=!0,void this.menuRef.classList.add("smart-hidden"))}}})();